<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=5.0, user-scalable=yes, viewport-fit=cover">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="format-detection" content="telephone=no">
    <meta name="theme-color" content="#ffffff">
    <meta name="apple-touch-fullscreen" content="yes">
    <meta name="HandheldFriendly" content="true">
    <title>טופס איסוף נתונים לבעל מקצוע - Collabo AI Pro</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <!-- Simple Form to Prompt JSON - מוטמע בקובץ -->
    <style>
        :root {
            --ai-purple: rgba(76, 29, 149, 0.5);
            --text-primary: #37352f;
            --text-secondary: #6b7280;
            --text-muted: #9ca3af;
            --border-light: #e5e7eb;
            --bg-light: #ffffff;
            --bg-gray: #f3f4f6;
            --border-radius: 6px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;
            line-height: 1.5;
            color: #37352f;
            direction: rtl;
            background: #ffffff;
            font-weight: 400;
            min-height: 100vh;
            -webkit-text-size-adjust: 100%;
            -ms-text-size-adjust: 100%;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 24px;
        }

        .main-wrapper {
            min-height: 100vh;
            background: var(--bg-gray);
            padding: 60px 0;
        }

        .page-header {
            text-align: center;
            margin-bottom: 60px;
        }

        .page-header h1 {
            font-size: 2.5em;
            font-weight: 800;
            color: var(--text-primary);
            margin-bottom: 16px;
            letter-spacing: -0.025em;
        }

        .page-header p {
            font-size: 1em;
            color: var(--text-secondary);
            max-width: 600px;
            margin: 0 auto;
        }

        .brand-tag {
            display: inline-block;
            background: rgba(76, 29, 149, 0.8);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 600;
            margin-bottom: 24px;
            letter-spacing: 0.5px;
        }

        /* Contact Form Styles - מעתק מדף הנחיתה */
        .contact-form {
            max-width: 700px;
            margin: 0 auto;
        }

        .form-input {
            width: 100%;
            height: 48px;
            padding: 12px 20px;
            border: 2px solid var(--border-light);
            border-radius: var(--border-radius);
            font-size: 16px;
            font-family: inherit;
            background: var(--bg-light);
            color: var(--text-primary);
            transition: all 0.3s ease;
            box-sizing: border-box;
            text-align: right;
        }

        .form-input::placeholder {
            color: var(--text-muted);
        }

        .form-input:focus {
            outline: none;
            border-color: var(--ai-purple);
            box-shadow: 0 0 0 3px rgba(76, 29, 149, 0.2);
            background: rgba(255, 255, 255, 0.15);
            transform: scale(1.02);
        }

        .form-section {
            margin-bottom: 60px;
            padding: 32px;
            background: white;
            border-radius: 12px;
            border: 1px solid #e5e7eb;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
        }

        .form-section h3 {
            font-size: 24px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 0px;
        }

        .section-description {
            background: rgba(76, 29, 149, 0.05);
            border: 1px solid rgba(76, 29, 149, 0.15);
            border-radius: var(--border-radius);
            padding: 12px;
            margin-top: 8px;
            margin-bottom: 20px;
            font-size: 14px;
            line-height: 1.6;
            color: var(--text-secondary);
        }

        .section-description strong {
            color: var(--text-primary);
            font-weight: 600;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 14px;
            margin-bottom: 28px;
        }

        .form-group:last-child {
            margin-bottom: 0;
        }

        .form-label {
            display: block;
            font-size: 1.1em;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0;
        }

        .question-number {
            color: var(--ai-purple);
            font-weight: 800;
            margin-left: 8px;
        }

        .form-textarea {
            min-height: 100px;
            resize: vertical;
        }

        /* Radio/Checkbox Groups */
        .radio-group {
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
            margin-top: 0;
            flex-direction: column;
        }

        /* Yes/No radio groups - horizontal layout */
        .radio-group.yes-no {
            flex-direction: row;
            justify-content: flex-start;
        }

        .radio-group.yes-no .radio-item {
            flex: 0 0 auto;
            min-width: 80px;
            max-width: 120px;
        }

        .radio-item {
            display: flex;
            align-items: center;
            gap: 12px;
            height: 48px;
            padding: 12px 20px;
            background: var(--bg-light);
            border: 2px solid var(--border-light);
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            box-sizing: border-box;
        }

        .radio-item:hover {
            border-color: var(--ai-purple);
            background: rgba(76, 29, 149, 0.05);
        }

        .radio-item input {
            accent-color: rgba(76, 29, 149, 0.8);
        }

        .radio-item.selected {
            border-color: rgba(76, 29, 149, 0.8);
            background: rgba(76, 29, 149, 0.1);
            color: rgba(76, 29, 149, 0.8);
            font-weight: 600;
        }

        /* Dropdown styling */
        .dropdown-list {
            font-size: 14px;
            max-height: 240px; /* Height for exactly 5 items (48px each) */
        }

        .dropdown-item {
            padding: 12px 16px;
            cursor: pointer;
            border-bottom: 1px solid #f3f4f6;
            text-align: right;
            transition: background-color 0.2s ease;
            height: 48px;
            display: flex;
            align-items: center;
        }

        .dropdown-item:last-child {
            border-bottom: none;
        }

        .dropdown-item:hover {
            background-color: #f8fafc;
        }

        .dropdown-item.highlighted {
            background-color: rgba(76, 29, 149, 0.1);
            color: rgba(76, 29, 149, 0.8);
        }



        /* Checkbox styling in dropdown */
        .restriction-checkbox-item,
        .work-area-checkbox-item {
            padding: 12px 16px;
            border-bottom: 1px solid #f3f4f6;
            height: 48px;
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        .restriction-checkbox-item:hover,
        .work-area-checkbox-item:hover {
            background-color: #f8fafc;
        }

        .restriction-checkbox-item:last-child,
        .work-area-checkbox-item:last-child {
            border-bottom: none;
        }

        .restriction-checkbox-item input[type="checkbox"],
        .work-area-checkbox-item input[type="checkbox"] {
            accent-color: rgba(76, 29, 149, 0.8);
        }



        /* Restriction dropdown styling */
        .restriction-select-container {
            position: relative;
            width: 100%;
        }

        .restriction-select {
            width: 100%;
            height: 48px;
            padding: 12px 20px;
            border: 2px solid var(--border-light);
            border-radius: var(--border-radius);
            background: white;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 16px;
            transition: all 0.3s ease;
            box-sizing: border-box;
        }

        .restriction-select:hover {
            border-color: var(--ai-purple);
        }

        .restriction-select.active {
            border-color: var(--ai-purple);
            box-shadow: 0 0 0 3px rgba(76, 29, 149, 0.2);
        }

        .restriction-placeholder {
            color: var(--text-muted);
        }

        .restriction-arrow {
            transition: transform 0.3s ease;
            color: var(--text-muted);
        }

        .restriction-select.active .restriction-arrow {
            transform: rotate(180deg);
        }

        .restriction-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            z-index: 1000;
            display: none;
            max-height: 300px;
            overflow-y: auto;
        }


        .restriction-tags,
        .work-area-tags,
        .business-benefits-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 0;
            min-height: 0;
        }

        /* Business benefits dropdown styling */
        #businessBenefitsContainer {
            position: relative;
        }

        #businessBenefitsDisplay {
            cursor: pointer;
            transition: border-color 0.2s;
        }

        #businessBenefitsDisplay:hover {
            border-color: var(--ai-purple);
        }

        #businessBenefitsDropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 1000;
            max-height: 300px;
            overflow-y: auto;
        }

        #businessBenefitsDropdown[style*="block"] {
            display: block !important;
        }

        /* Business benefit input styling */
        .business-benefit-input {
            transition: all 0.2s ease;
        }

        .business-benefit-input:focus {
            border-color: var(--ai-purple) !important;
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1) !important;
        }

        .business-benefit-input:hover {
            border-color: #d1d5db;
        }

        .restriction-tags:not(:empty),
        .work-area-tags:not(:empty),
        .business-benefits-tags:not(:empty) {
            margin-top: 0;
        }

        .restriction-tag,
        .work-area-tag,
        .business-benefit-tag {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            background: rgba(76, 29, 149, 0.1);
            color: rgba(76, 29, 149, 0.8);
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
            border: 1px solid rgba(76, 29, 149, 0.2);
        }

        .restriction-tag .remove-tag,
        .work-area-tag .remove-tag,
        .business-benefit-tag .remove-tag {
            cursor: pointer;
            font-weight: bold;
            font-size: 16px;
            line-height: 1;
            padding: 2px;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(76, 29, 149, 0.2);
            color: rgba(76, 29, 149, 0.8);
        }

        .restriction-tag .remove-tag:hover,
        .work-area-tag .remove-tag:hover,
        .business-benefit-tag .remove-tag:hover {
            background: rgba(76, 29, 149, 0.3);
        }

        /* Custom restriction input styling */
        .custom-restriction-container {
            padding: 16px;
            border-bottom: 1px solid #e5e7eb;
            background: #ffffff;
            border-radius: 0;
        }

        .custom-restriction-container .input-label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            color: #374151;
            margin-bottom: 12px;
            text-align: right;
        }

        .custom-restriction-input-group {
            width: 100%;
        }

        .custom-restriction-container input,
        .custom-restriction-input {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
            text-align: right;
            transition: border-color 0.2s ease;
            background: white;
            box-sizing: border-box;
            margin: 0;
            height: 40px;
        }

        .custom-restriction-container input:focus,
        .custom-restriction-input:focus {
            outline: none;
            border-color: rgba(76, 29, 149, 0.6);
            box-shadow: 0 0 0 3px rgba(76, 29, 149, 0.1);
        }

        /* Work area dropdown styling - copied from restriction dropdown */
        .work-area-select-container {
            position: relative;
            width: 100%;
        }

        .work-area-select {
            width: 100%;
            height: 48px;
            padding: 12px 20px;
            border: 2px solid var(--border-light);
            border-radius: var(--border-radius);
            background: white;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 16px;
            transition: all 0.3s ease;
            box-sizing: border-box;
        }

        .work-area-select:hover {
            border-color: var(--ai-purple);
        }

        .work-area-select.active {
            border-color: var(--ai-purple);
            box-shadow: 0 0 0 3px rgba(76, 29, 149, 0.2);
        }

        .work-area-placeholder {
            color: var(--text-muted);
        }

        .work-area-arrow {
            transition: transform 0.3s ease;
            color: var(--text-muted);
        }

        .work-area-select.active .work-area-arrow {
            transform: rotate(180deg);
        }

        .work-area-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            z-index: 1000;
            display: none;
            max-height: 300px;
            overflow-y: auto;
        }



        
        .dropdown-option:hover {
            background-color: #f9fafb;
        }
        
        .dropdown-option:last-child {
            border-bottom: none;
        }

        /* Submit Button - מעתק מדף הנחיתה */
        .contact-form button {
            width: 100%;
            padding: 16px 20px;
            background: rgba(76, 29, 149, 0.8);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 0px;
        }

        .contact-form button:hover {
            background: #3730a3;
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(76, 29, 149, 0.3);
        }

        .footer-info {
            text-align: center;
            margin-top: 40px;
            color: var(--text-secondary);
            font-size: 1.1em;
        }

        .footer-info .brand {
            font-weight: 600;
            color: var(--text-primary);
            margin-top: 16px;
        }

        /* Responsive Design */
        /* Large mobile / Small tablet styles (600px and below) */
        @media (max-width: 600px) {
            .container {
                padding: 0 14px;
            }
            
        }
        
        /* Tablet styles (768px and below) */
        @media (max-width: 768px) {
            .container {
                padding: 0 16px;
            }

            .main-wrapper {
                padding: 40px 0;
            }

            .page-header h1 {
                font-size: 2em;
            }

            .page-header p {
                font-size: 1em;
            }

            .form-section {
                padding: 24px;
                margin-bottom: 40px;
            }

            .form-input, .work-area-select, .restriction-select, .radio-item {
                height: 44px;
                padding: 10px 16px;
                font-size: 16px;
            }

            .form-label {
                font-size: 15px;
                margin-bottom: 0;
            }

            .question-number {
                font-size: 18px;
            }

            .radio-group {
                flex-direction: column;
            }

            .radio-item {
                min-width: 100%;
            }


            .contact-form button {
                padding: 14px 20px;
                font-size: 16px;
            }
        }

        /* Desktop styles (769px and above) - Allow flex changes */
        @media (min-width: 769px) {
        }

        /* Mobile styles (480px and below) */
        @media (max-width: 480px) {
            .container {
                padding: 0 12px;
            }

            .main-wrapper {
                padding: 20px 0;
            }

            .page-header {
                margin-bottom: 12px;
            }

            .page-header h1 {
                font-size: 1.5em;
                margin-bottom: 12px;
            }

            .page-header p {
                font-size: 0.875em;
            }

            .brand-tag {
                font-size: 0.8em;
                padding: 6px 12px;
                margin-bottom: 16px;
            }

            .form-section {
                padding: 8px 16px 16px 16px;
                margin-bottom: 24px;
            }

            .form-section h3 {
                font-size: 24px;
                margin-bottom: 0px;
            }

            .form-group {
                gap: 14px;
                margin-bottom: 24px;
            }

            .form-input, .work-area-select, .restriction-select, .radio-item {
                height: 44px;
                padding: 10px 14px;
                font-size: 14px;
                border-width: 1px;
            }

            .form-label {
                font-size: 16px;
                margin-bottom: 0;
            }

            .question-number {
                font-size: 16px;
                margin-left: 8px;
            }


            /* Mobile dropdown adjustments */
            #businessBenefitsDisplay {
                height: auto;
                min-height: 44px;
                padding: 10px 14px;
            }

            .dropdown-option {
                padding: 12px 14px;
                font-size: 14px;
            }

            /* Mobile radio buttons - yes/no specific */
            .radio-group.yes-no {
                flex-direction: row;
                gap: 8px;
            }

            .radio-group.yes-no .radio-item {
                flex: 1;
                min-width: auto;
                max-width: none;
                text-align: center;
                justify-content: center;
            }
            
            /* Mobile radio buttons - regular groups stay vertical */
            .radio-group:not(.yes-no) {
                flex-direction: column;
                gap: 8px;
            }
            
            .radio-group:not(.yes-no) .radio-item {
                width: 100%;
                justify-content: flex-start;
                text-align: right;
                padding: 12px 16px;
                height: 44px;
                gap: 10px;
            }
            
            .radio-group:not(.yes-no) .radio-item span {
                line-height: 1.4;
                word-wrap: break-word;
            }

            /* Mobile tags */
            .work-area-tag, .restriction-tag {
                font-size: 12px;
                padding: 4px 8px;
            }

            .contact-form button {
                padding: 12px 16px;
                font-size: 14px;
                height: 48px;
            }

            /* Fix mobile touch targets */
            .fas {
                font-size: 14px;
            }

            
            
            /* Mobile business benefits display */
            #businessBenefitsDisplay {
                padding: 10px 14px !important;
                border-width: 1px !important;
                font-size: 14px !important;
            }
            
            #businessBenefitsDisplay span {
                font-size: 14px !important;
            }
            
            /* Mobile business benefit inputs */
            .business-benefit-input {
                font-size: 14px !important;
                padding: 10px 14px 10px 35px !important;
                text-align: right !important;
            }
            
            /* Mobile restriction inputs */
            .restriction-input {
                font-size: 14px !important;
                padding: 10px 14px 10px 35px !important;
                text-align: right !important;
            }
            
            /* Preview Section Styles */
            @keyframes spin {
                0% { transform: rotate(0deg); }
                100% { transform: rotate(360deg); }
            }
            
            .preview-btn:hover {
                background: linear-gradient(135deg, #5b64f0, #7c3aed) !important;
                transform: translateY(-1px);
                box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
            }
            
            .preview-post {
                background: #f8fafc;
                border: 1px solid #e2e8f0;
                border-radius: 8px;
                padding: 16px;
                margin-bottom: 16px;
            }
            
            .preview-post-content {
                background: white;
                padding: 12px;
                border-radius: 6px;
                margin-bottom: 12px;
                border-left: 4px solid #3b82f6;
            }
            
            .preview-response {
                background: #f0f9ff;
                border: 1px solid #0ea5e9;
                border-radius: 6px;
                padding: 12px;
                margin-top: 8px;
            }
            
            .preview-response-header {
                font-weight: 600;
                color: #0c4a6e;
                margin-bottom: 8px;
                display: flex;
                align-items: center;
                gap: 8px;
            }
            
            .preview-response-content {
                color: #334155;
                line-height: 1.6;
                white-space: pre-wrap;
            }

            /* Mobile custom inputs */
            .custom-benefit-input, .custom-restriction-input {
                font-size: 14px !important;
                height: 44px !important;
                padding: 10px 14px !important;
            }
            
            /* Mobile textarea */
            .form-textarea {
                font-size: 14px !important;
                padding: 10px 14px !important;
            }
            
            
            /* Mobile dropdown options */
            .dropdown-option {
                padding: 12px 14px !important;
                font-size: 14px !important;
            }
            
            /* Mobile specific spacing fixes */
            .form-section {
                margin-bottom: 40px !important;
            }
            
            .form-group {
                gap: 14px;
                margin-bottom: 22px !important;
            }
            
            /* Mobile viewport fix */
            body {
                -webkit-text-size-adjust: 100%;
                -webkit-font-smoothing: antialiased;
            }
            
            /* Mobile tag styling */
            .work-area-tag, .restriction-tag, .business-benefit-tag {
                font-size: 12px !important;
                padding: 4px 8px !important;
                margin: 2px !important;
            }
            
            /* Mobile form containers responsive */
            .work-area-tags, .restriction-tags, .business-benefits-tags {
                margin-top: 0 !important;
            }
            
            /* Mobile button improvements */
            .contact-form button:hover {
                transform: none;
            }
            
            /* Better mobile touch targets for dropdowns */
            .dropdown-option:hover {
                background-color: #f3f4f6 !important;
            }
        }
        /* Facebook-style preview section */
        .facebook-post-card {
            background: white;
            border: 1px solid #dddfe2;
            border-radius: 8px;
            margin-bottom: 16px;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        .post-header {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            border-bottom: 1px solid #f0f2f5;
        }

        .post-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #1877f2;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 16px;
            margin-left: 12px;
        }

        .post-meta {
            flex: 1;
        }

        .post-author {
            font-weight: 600;
            color: #1c1e21;
            font-size: 15px;
            margin-bottom: 2px;
        }

        .post-time {
            color: #65676b;
            font-size: 13px;
        }

        .post-content {
            padding: 0 16px 12px;
            color: #1c1e21;
            line-height: 1.34;
            font-size: 15px;
        }

        .post-interactions {
            border-top: 1px solid #f0f2f5;
            padding: 8px 16px;
        }

        .interactions-bar {
            display: flex;
            justify-content: space-around;
        }

        .interaction-btn {
            color: #65676b;
            font-size: 15px;
            font-weight: 600;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .interaction-btn:hover {
            background-color: #f0f2f5;
        }

        .comments-section {
            border-top: 1px solid #f0f2f5;
            padding: 12px 16px;
            background: #f8f9fa;
        }

        .comment {
            display: flex;
            align-items: flex-start;
        }

        .comment-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: #42b883;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 14px;
            margin-left: 8px;
            flex-shrink: 0;
        }

        .comment-content {
            flex: 1;
        }

        .comment-author {
            font-weight: 600;
            color: #1c1e21;
            font-size: 13px;
            margin-bottom: 2px;
        }

        .comment-text {
            background: #f0f2f5;
            padding: 8px 12px;
            border-radius: 16px;
            color: #1c1e21;
            font-size: 14px;
            line-height: 1.34;
            margin-bottom: 4px;
            display: inline-block;
        }

        .comment-text a {
            color: #25d366 !important;
            text-decoration: none;
            font-weight: 500;
            transition: color 0.2s ease;
        }

        .comment-text a:hover {
            color: #128c7e !important;
            text-decoration: underline;
        }

        .comment-actions {
            display: flex;
            align-items: center;
            gap: 12px;
            padding-right: 12px;
        }

        .comment-action {
            color: #65676b;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
        }

        .comment-action:hover {
            text-decoration: underline;
        }

        .comment-time {
            color: #65676b;
            font-size: 12px;
        }

        .comment-source {
            color: #1877f2;
            font-size: 11px;
            background: #e7f3ff;
            padding: 2px 6px;
            border-radius: 10px;
            margin-right: auto;
        }
    </style>
</head>
<body>
    <div class="main-wrapper">
        <div class="container">
            <div class="page-header">
                <div class="brand-tag">Collabo AI Pro</div>
                <h1>טופס איסוף נתונים לבעל מקצוע</h1>
                <p>כדי ליצור עבורכם מערכת תגובות מותאמת אישית שתייצג אתכם בצורה הכי טובה, אנחנו צריכים לאסוף מספר פרטים חשובים.</p>
            </div>

            <form class="contact-form" id="clientForm">
                <!-- פרטים בסיסיים -->
                <div class="form-section">
                    <h3>פרטים בסיסיים</h3>
                    <div class="section-description">
                        פרטים בסיסיים ליצירת זהות מקצועית ברורה בתגובות.
                    </div>

                    <div class="form-group">
                        <label class="form-label">
                            <span class="question-number">1.</span>
                            שם העסק שלכם <strong>(כפי שתרצו שיופיע בתגובות)</strong>:
                        </label>
                        <input type="text" class="form-input" name="client_name" placeholder="לדוגמה: משה, דני הטכנאי, אליהו" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">
                            <span class="question-number">2.</span>
                            תחום פעילות העיקרי שלכם:
                        </label>
                        <div class="dropdown-container" style="position: relative;">
                            <input type="text" class="form-input" id="primaryFieldInput" name="primary_field" placeholder="הקלידו לחיפוש תחום פעילות..." required style="text-align: right;" autocomplete="off">
                            <div id="dropdownList" class="dropdown-list" style="display: none; position: absolute; top: 100%; left: 0; right: 0; background: white; border: 1px solid #e5e7eb; border-radius: 6px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); z-index: 1000; max-height: 200px; overflow-y: auto;">
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">
                            <span class="question-number">3.</span>
                            כמה שנים העסק שלכם פעיל?
                        </label>
                        <input type="number" class="form-input" name="experience_years" placeholder="לדוגמה: 12" required min="1" max="50">
                    </div>

                    <div class="form-group">
                        <label class="form-label">
                            <span class="question-number">4.</span>
                            מספר טלפון ליצירת קשר:
                        </label>
                        <input type="tel" class="form-input" name="phone_number" placeholder="לדוגמה: 050-1234567" required style="text-align: right;">
                    </div>

                    <div class="form-group">
                        <label class="form-label">
                            <span class="question-number">5.</span>
                            באילו אזורים אתם עובדים? <strong>(ניתן לבחור כמה אפשרויות)</strong>
                        </label>
                        
                        <div class="work-area-select-container">
                            <div class="work-area-select" id="workAreaSelect" tabindex="0">
                                <span class="work-area-placeholder">לחץ לבחירת אזורי עבודה</span>
                                <i class="fas fa-chevron-down work-area-arrow"></i>
                            </div>
                            <div class="work-area-dropdown" id="workAreaDropdown"></div>
                        </div>
                        
                        <div class="work-area-tags" id="workAreaTags"></div>
                    </div>
                </div>

                <!-- יתרונות עסקיים -->
                <div class="form-section">
                    <h3>יתרונות עסקיים</h3>
                    <div class="section-description">
                        הוסיפו לפחות 4 יתרונות עסקיים שמייחדים אתכם מהמתחרים ומושכים לקוחות.
                    </div>

                    <div class="form-group">
                        <label class="form-label">
                            <span class="question-number">6.</span>
                            בחרו יתרונות עסקיים <strong>(לפחות 4 יתרונות)</strong>
                        </label>
                        
                        <div id="businessBenefitsContainer" style="position: relative;">
                            <div id="businessBenefitsDisplay" style="padding: 12px 20px; border: 2px solid var(--border-light); border-radius: var(--border-radius); background: var(--bg-light); cursor: pointer; display: flex; flex-wrap: wrap; gap: 8px; align-items: center; min-height: 48px; position: relative; box-sizing: border-box;">
                                <span id="businessBenefitsPlaceholder" style="color: var(--text-muted);">לחצו לבחירת יתרונות עסקיים</span>
                                <i class="fas fa-chevron-down" style="position: absolute; left: 16px; top: 16px; color: var(--text-muted);"></i>
                            </div>
                            <div id="businessBenefitsDropdown" style="display: none; position: absolute; top: 100%; left: 0; right: 0; background: white; border: 1px solid #e5e7eb; border-radius: 6px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); z-index: 1000; max-height: 300px; overflow-y: auto;">
                            </div>
                        </div>
                        
                        <div class="business-benefits-tags" id="businessBenefitsTags" style="margin-top: 12px;"></div>
                    </div>
                </div>

                <!-- התמחויות נוספות -->
                <div class="form-section">
                    <h3>התמחויות נוספות</h3>
                    <div class="section-description">
                        בחרו התמחויות נוספות או תתי-תחומים שאתם מספקים שירותים בהם. ניתן לבחור מהתחום העיקרי שלכם או מתחומים אחרים.
                    </div>
                    <div class="form-group">
                        <label class="form-label">
                            <span class="question-number">7.</span>
                            התמחויות נוספות <strong>(אופציונלי)</strong>
                        </label>
                        
                        <div id="specializationsContainer" style="position: relative;">
                            <div id="specializationsDisplay" style="padding: 12px 20px; border: 2px solid var(--border-light); border-radius: var(--border-radius); background: var(--bg-light); cursor: pointer; display: flex; flex-wrap: wrap; gap: 8px; align-items: center; min-height: 48px; position: relative; box-sizing: border-box;">
                                <span id="specializationsPlaceholder" style="color: var(--text-muted);">לחצו לבחירת התמחויות נוספות</span>
                                <i class="fas fa-chevron-down" style="position: absolute; left: 16px; top: 16px; color: var(--text-muted);"></i>
                            </div>
                            <div id="specializationsDropdown" style="display: none; position: absolute; top: 100%; left: 0; right: 0; background: white; border: 1px solid #e5e7eb; border-radius: 6px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); z-index: 1000; max-height: 400px; overflow-y: auto;">
                            </div>
                        </div>
                        
                        <div class="specializations-tags" id="specializationsTags" style="margin-top: 12px;"></div>
                    </div>
                </div>


                <!-- הגדרות מיוחדות -->
                <div class="form-section">
                    <h3>הגדרות מיוחדות</h3>
                    <div class="section-description">
                        הגדירו נושאים להימנעות בתגובות. זה שומר על מקצועיות ומתאים לפרופיל שלכם. אם אין לכם הגבלות מיוחדות, דלגו על השאלה.
                    </div>

                    <div class="form-group">
                        <label class="form-label">
                            <span class="question-number">8.</span>
                            יש נושאים שאתם מעדיפים להימנע מהם בתגובות? <strong>(עד 5 נושאים)</strong>
                        </label>
                        
                        <div class="restriction-select-container">
                            <div class="restriction-select" id="restrictionSelect" tabindex="0">
                                <span class="restriction-placeholder">לחץ לבחירת נושאים להימנעות</span>
                                <i class="fas fa-chevron-down restriction-arrow"></i>
                            </div>
                            <div class="restriction-dropdown" id="restrictionDropdown"></div>
                        </div>
                        
                        <div class="restriction-tags" id="restrictionTags"></div>

                    </div>

                    <div class="form-group">
                        <label class="form-label">
                            <span class="question-number">9.</span>
                            הערות נוספות או בקשות מיוחדות:
                        </label>
                        <textarea class="form-input form-textarea" name="additional_notes" placeholder="כל מידע נוסף שחשוב לכם שנדע..."></textarea>
                    </div>
                </div>

                <!-- Live Preview Section -->
                <div class="form-section" id="livePreviewSection" style="display: block; border: 2px dashed #6366f1; background: linear-gradient(135deg, rgba(99, 102, 241, 0.05), rgba(139, 92, 246, 0.05)); padding: 20px 32px !important; margin: 60px 0 !important;">
                    <h3 style="text-align: center; margin-top: 0;">תצוגה מקדימה - איך הסוכן שלך יגיב לפוסטים</h3>
                    <h4 style="text-align: center; color: var(--text-secondary); font-weight: 400; margin-top: 8px; margin-bottom: 20px;">לפני שליחת הטופס, בואו נראה איך הסוכן שלך יגיב לפוסטים דומים בתחום שלך</h4>
                    
                    <button type="button" id="generatePreviewBtn" class="preview-btn" style="width: auto; padding: 12px 24px; background: linear-gradient(135deg, #6366f1, #8b5cf6); color: white; border: none; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer; margin: 20px auto 0 auto; display: block;">
                        🚀 תראה לי איך הסוכן שלי מגיב לפוסטים
                    </button>
                    
                    <div id="previewContainer" style="display: none;">
                        <div id="previewLoading" style="text-align: center; padding: 20px; display: none;">
                            <div style="display: inline-block; width: 40px; height: 40px; border: 4px solid #f3f3f3; border-top: 4px solid #6366f1; border-radius: 50%; animation: spin 1s linear infinite;"></div>
                            <p style="margin-top: 10px; color: #6b7280;">יוצר דוגמאות פוסטים ותשובות...</p>
                        </div>
                        
                        <div id="previewResults"></div>
                    </div>
                </div>

                <button type="submit" id="submitBtn">שלח טופס</button>
            </form>

            <div class="footer-info">
                ✅ בסיום המילוי, הטופס יישלח אלינו אוטומטית.<br>
                ⏰ תהליך הכנת המערכת לוקח 24-48 שעות לאחר קבלת הטופס המלא.
                <div class="brand">
                    תודה רבה על הסבלנות! 🙏<br>
                    צוות Collabo AI
                </div>
            </div>
        </div>
    </div>

    <script>
        // Function to format links in text
        function formatLinksInText(text) {
            if (!text) return text;
            
            console.log('Original text:', text); // Debug log
            
            // Convert line breaks to <br> tags first
            let formattedText = text.replace(/\n/g, '<br>');
            
            // Convert WhatsApp URLs to clickable links - more aggressive regex
            const whatsappRegex = /(https:\/\/wa\.me\/[^\s<>\n]+)/g;
            const matches = formattedText.match(whatsappRegex);
            console.log('WhatsApp matches found:', matches); // Debug log
            
            if (matches) {
                matches.forEach(match => {
                    const clickableLink = `<br><a href="${match}" target="_blank" rel="noopener noreferrer" style="color: #25d366; text-decoration: none; font-weight: 500; display: block; margin-top: 8px; direction: ltr;">${match}</a>`;
                    formattedText = formattedText.replace(match, clickableLink);
                });
            }
            
            console.log('Formatted text:', formattedText); // Debug log
            return formattedText;
        }

        // API Configuration
        const API_BASE_URL = 'https://worthy-choice-badger.ngrok-free.app';

        document.addEventListener('DOMContentLoaded', function() {
            // Primary field dropdown functionality
            const primaryFieldInput = document.getElementById('primaryFieldInput');
            const dropdownList = document.getElementById('dropdownList');
            
            const professions = [
                'חשמל',
                'אינסטלציה',
                'שיפוצים כלליים',
                'צבע ועבודות גמר',
                'ריצוף וחיפוי',
                'נגרות',
                'ברזל ואלומיניום',
                'מיזוג אוויר',
                'גינון ונוף',
                'בטון וחזית',
                'בידוד וייטום',
                'ניקיון ואחזקה',
                'הסעות והובלות',
                'מנעולנות',
                'שמשות ומרפסות',
                'פלמבה וביובים',
                'אנטנות וויזיון',
                'פיתוח מגרשים',
                'עבודות גובה',
                'חיפוי קירות',
                'חימום ורדיאטורים',
                'פתיחת קירות',
                'עבודות פחזון',
                'איטום גגות',
                'תקשורת ורשתות',
                'אבן טבעית',
                'מטבחים מעוצבים',
                'חדרי רחצה',
                'ארונות ואחסון',
                'דקינג ופרגולות',
                'מרצפת אבן',
                'עבודות עפר',
                'גדרות ושערים',
                'בניית מחסנים',
                'עבודות אספלט',
                'ציפוי גגות',
                'תאורה חיצונית',
                'מעליות ונגישות'
            ];

            // התמחויות נוספות - תתי-קטגוריות לכל תחום
            const specializations = {
                'חשמל': [
                    'תיקון תקלות חשמל',
                    'התקנת לוח חשמל',
                    'הוספת נקודות חשמל',
                    'חיווט מבנים',
                    'התקנת מערכות תאורה',
                    'חשמל תלת פאזי',
                    'מערכות חירום ובטיחות',
                    'מערכות סולאריות'
                ],
                'אינסטלציה': [
                    'תיקון צנרת',
                    'התקנת מערכות מים',
                    'פתיחת סתימות',
                    'התקנת ברזים ואביזרים',
                    'מערכות השקיה',
                    'מערכות ניקוז',
                    'בדיקת לחץ מים',
                    'תיקון דלפת מים'
                ],
                'שיפוצים כלליים': [
                    'שיפוץ דירות',
                    'שיפוץ בתים',
                    'שיפוץ משרדים',
                    'עבודות תחזוקה',
                    'הריסות קלות',
                    'בנייה קלה',
                    'עבודות גבס',
                    'התקנת רצפות'
                ],
                'צבע ועבודות גמר': [
                    'צביעת קירות',
                    'צביעת תקרות',
                    'עבודות שפכטל',
                    'צביעת חזיתות',
                    'עבודות דקורציה',
                    'הסרת טפטים',
                    'הדבקת טפטים',
                    'עבודות אומן'
                ],
                'ריצוף וחיפוי': [
                    'ריצוף דירות',
                    'חיפוי קירות',
                    'מקלחונים',
                    'עבודות פסיפס',
                    'ריצוף חוץ',
                    'חיפוי מטבחים',
                    'תיקון אריחים',
                    'איטום רטיבות'
                ],
                'נגרות': [
                    'ארונות מטבח',
                    'דלתות',
                    'חלונות עץ',
                    'ריהוט מעוצב',
                    'פרקט',
                    'תיקון רהיטים',
                    'ארונות בגדים',
                    'נגרות קלה'
                ],
                'ברזל ואלומיניום': [
                    'שערים',
                    'גדרות',
                    'סורגים',
                    'מעקות',
                    'דלתות ברזל',
                    'חלונות אלומיניום',
                    'פרגולות ברזל',
                    'עבודות ריתוך'
                ],
                'מיזוג אוויר': [
                    'התקנת מזגנים',
                    'תחזוקת מזגנים',
                    'תיקון מזגנים',
                    'מערכות מיזוג מרכזיות',
                    'VRF מערכות',
                    'חידוש גז',
                    'ניקוי מערכות',
                    'בדיקות תקופתיות'
                ],
                'גינון ונוף': [
                    'עיצוב גינות',
                    'שתילת עצים',
                    'מערכות השקיה',
                    'גיזום עצים',
                    'טיפוח דשא',
                    'בניית גינות',
                    'פיתוח נוף',
                    'צמחיית נוי'
                ],
                'בטון וחזית': [
                    'יציקת בטון',
                    'ציפוי חזיתות',
                    'תיקון סדקים',
                    'איטום קירות',
                    'עבודות שיקום',
                    'בטון מוחלק',
                    'בטון מוטבע',
                    'קירות תומכים'
                ],
                'בידוד וייטום': [
                    'בידוד תרמי',
                    'בידוד אקוסטי',
                    'איטום גגות',
                    'איטום מרפסות',
                    'בידוד קירות',
                    'איטום מרתפים',
                    'בידוד צנרת',
                    'איטום חלונות'
                ],
                'ניקיון ואחזקה': [
                    'ניקיון בתים',
                    'ניקיון משרדים',
                    'ניקיון חלונות',
                    'ניקיון אחרי בנייה',
                    'שטיפת בניינים',
                    'אחזקת מבנים',
                    'ניקיון מיוחד',
                    'חברות ניקיון'
                ],
                'הסעות והובלות': [
                    'הובלת דירות',
                    'הסעות עובדים',
                    'הובלת חפצים',
                    'מעברי דירה',
                    'הובלת משרדים',
                    'הובלות מיוחדות',
                    'שירותי מנוף',
                    'אחסון חפצים'
                ],
                'מנעולנות': [
                    'פתיחת דלתות',
                    'החלפת מנעולים',
                    'תיקון מנעולים',
                    'מנעולי בטחון',
                    'מערכות ביטחון',
                    'מפתחות מאסטר',
                    'כספות',
                    'מנעולים חכמים'
                ],
                'שמשות ומרפסות': [
                    'סגירת מרפסות',
                    'התקנת שמשות',
                    'תיקון שמשות',
                    'זכוכיות מבנה',
                    'חלונות ודלתות',
                    'מחיצות זכוכית',
                    'מקלחונים',
                    'ויטרינות'
                ],
                'פלמבה וביובים': [
                    'פתיחת סתימות',
                    'תיקון צנרת ביוב',
                    'מצלמת ביוב',
                    'החלפת צנרת',
                    'ביובים מרכזיים',
                    'שאיבת בורות',
                    'ניקוי צנרת',
                    'בדיקות ביוב'
                ],
                'אנטנות וויזיון': [
                    'התקנת אנטנות',
                    'תיקון קליטה',
                    'מערכות לוויין',
                    'רשתות תקשורת',
                    'אינטרנט ביתי',
                    'מערכות אבטחה',
                    'מצלמות אבטחה',
                    'מערכות קול'
                ],
                'פיתוח מגרשים': [
                    'פינוי עפר',
                    'ניקוי מגרשים',
                    'סלילת דרכים',
                    'עבודות עפר',
                    'ניקוז שטחים',
                    'הכנת יסודות',
                    'פיתוח תשתיות',
                    'גנון וחזקה'
                ],
                'עבודות גובה': [
                    'צביעת בניינים',
                    'תיקון חזיתות',
                    'ניקוי גגות',
                    'התקנת שלטים',
                    'עבודות איטום',
                    'תחזוקת מבנים',
                    'עבודות מנוף',
                    'גישה בחבלים'
                ],
                'חיפוי קירות': [
                    'אבן טבעית',
                    'אבן מלאכותית',
                    'חיפוי פנים',
                    'חיפוי חוץ',
                    'טיח נוי',
                    'עבודות דקורציה',
                    'חיפוי בריקים',
                    'פנלים מעוצבים'
                ],
                'חימום ורדיאטורים': [
                    'התקנת רדיאטורים',
                    'תיקון חימום',
                    'מערכות חימום',
                    'דוד שמש',
                    'רצפה חמה',
                    'חימום מרכזי',
                    'תחזוקת מערכות',
                    'בקרות חימום'
                ],
                'פתיחת קירות': [
                    'פתיחת פתחים',
                    'פתיחת חלונות',
                    'פתיחת דלתות',
                    'הריסות מבוקרות',
                    'חיזוק מבנים',
                    'עבודות יציבות',
                    'הסרת קירות',
                    'עבודות בטון'
                ],
                'עבודות פחזון': [
                    'תיקון פחזון',
                    'החלפת צנרת',
                    'פח וביוב',
                    'תיקון דלפות',
                    'מערכות ניקוז',
                    'עבודות אטימה',
                    'ריתוך צנרת',
                    'התקנת מערכות'
                ],
                'איטום גגות': [
                    'איטום גגות רעפים',
                    'איטום גגות בטון',
                    'תיקון נזילות',
                    'ציפוי גגות',
                    'מערכות ניקוז',
                    'בידוד גגות',
                    'גגות רעפים',
                    'גגות מתכת'
                ],
                'תקשורת ורשתות': [
                    'רשתות מחשבים',
                    'תקשורת מבנים',
                    'פריסת כבלים',
                    'מערכות אינטרקום',
                    'חיווט מובנה',
                    'רשתות אינטרנט',
                    'מערכות וידאו',
                    'בקרה ואוטומציה'
                ],
                'אבן טבעית': [
                    'חיפוי אבן',
                    'ריצוף אבן',
                    'עבודות שיש',
                    'גרניט ושיש',
                    'אבן קיסרסטון',
                    'מדרגות אבן',
                    'חזיתות אבן',
                    'מעצבות נוף'
                ],
                'מטבחים מעוצבים': [
                    'עיצוב מטבחים',
                    'ארונות מטבח',
                    'משטחי עבודה',
                    'מכשירי חשמל',
                    'חיפוי זכוכית',
                    'תאורת מטבח',
                    'ארגון מטבח',
                    'מטבחי יוקרה'
                ],
                'חדרי רחצה': [
                    'עיצוב אמבטיות',
                    'התקנת מקלחונים',
                    'ארונות אמבטיה',
                    'אינסטלציה סניטרית',
                    'חיפוי חדרי רחצה',
                    'תאורת רחצה',
                    'אביזרי רחצה',
                    'מקלחות מעוצבות'
                ],
                'ארונות ואחסון': [
                    'ארונות בגדים',
                    'פתרונות אחסון',
                    'חדרי ארונות',
                    'ארונות מעוצבים',
                    'מחיצות ארונות',
                    'ארונות קיר',
                    'מערכות הזזה',
                    'ארגון חללים'
                ],
                'דקינג ופרגולות': [
                    'דקים עץ',
                    'פרגולות עץ',
                    'פרגולות מתכת',
                    'סוכות קבועות',
                    'דקים מחומרים סינתטיים',
                    'פרגולות בד',
                    'מבני גן',
                    'פינות ישיבה'
                ],
                'מרצפת אבן': [
                    'מרצפות חצר',
                    'שבילי אבן',
                    'ריצוף חוץ',
                    'עבודות אבן',
                    'מדרגות חוץ',
                    'קירות אבן',
                    'אמצעות נוי',
                    'פיתוח נוף'
                ],
                'עבודות עפר': [
                    'חפירות',
                    'פינוי עפר',
                    'עבודות חפירה',
                    'יישור שטחים',
                    'הכנת יסודות',
                    'עבודות מחפר',
                    'בורות ושוחות',
                    'הכנת קרקע'
                ],
                'גדרות ושערים': [
                    'גדרות מתכת',
                    'גדרות עץ',
                    'שערים חשמליים',
                    'שערים ידניים',
                    'גדרות ביטחון',
                    'מעקות גינה',
                    'גדרות דקורטיביות',
                    'אוטומציה לשערים'
                ],
                'בניית מחסנים': [
                    'מחסנים מתכת',
                    'מחסנים בטון',
                    'מחסנים עץ',
                    'מבני אחסון',
                    'סככות',
                    'מחסנים חקלאיים',
                    'מבני תעשייה',
                    'מחסנים מוכנים'
                ],
                'עבודות אספלט': [
                    'סלילת דרכים',
                    'תיקון אספלט',
                    'חדשת מדרכות',
                    'חניות ורחבות',
                    'אספלט חם',
                    'סימון דרכים',
                    'תחזוקת כבישים',
                    'עבודות ציבוריות'
                ],
                'ציפוי גגות': [
                    'רעפי חרס',
                    'רעפי מתכת',
                    'גגות איזופנל',
                    'גגות ביטומניים',
                    'גגות רכים',
                    'תחזוקת גגות',
                    'בידוד גגות',
                    'מערכות ניקוז'
                ],
                'תאורה חיצונית': [
                    'תאורת גינה',
                    'זרקורים',
                    'תאורת בטיחות',
                    'תאורה סולארית',
                    'עמודי תאורה',
                    'בקרת תאורה',
                    'תאורה דקורטיבית',
                    'תאורת LED'
                ],
                'מעליות ונגישות': [
                    'התקנת מעליות',
                    'תחזוקת מעליות',
                    'מעליות נכים',
                    'כיסאות מעלה',
                    'פלטפורמות הרמה',
                    'רמפות נגישות',
                    'מעקות נגישות',
                    'שיפורי נגישות'
                ]
            };

            // מערך לאחסון ההתמחויות הנבחרות
            let selectedSpecializations = [];

            let currentFocus = -1;

            primaryFieldInput.addEventListener('input', function() {
                const value = this.value;
                if (value.length === 0) {
                    dropdownList.style.display = 'none';
                    return;
                }

                const filtered = professions.filter(profession => 
                    profession.includes(value)
                ); // Show all matching results

                if (filtered.length === 0) {
                    dropdownList.style.display = 'none';
                    return;
                }

                dropdownList.innerHTML = '';
                filtered.forEach((profession, index) => {
                    const item = document.createElement('div');
                    item.className = 'dropdown-item';
                    item.textContent = profession;
                    item.addEventListener('click', function() {
                        primaryFieldInput.value = profession;
                        dropdownList.style.display = 'none';
                        currentFocus = -1;
                    });
                    dropdownList.appendChild(item);
                });

                dropdownList.style.display = 'block';
                currentFocus = -1;
            });

            primaryFieldInput.addEventListener('focus', function() {
                if (this.value.length === 0) {
                    // Show all professions when focused with empty input
                    dropdownList.innerHTML = '';
                    professions.forEach((profession, index) => {
                        const item = document.createElement('div');
                        item.className = 'dropdown-item';
                        item.textContent = profession;
                        item.addEventListener('click', function() {
                            primaryFieldInput.value = profession;
                            dropdownList.style.display = 'none';
                            currentFocus = -1;
                        });
                        dropdownList.appendChild(item);
                    });
                    dropdownList.style.display = 'block';
                }
            });

            primaryFieldInput.addEventListener('keydown', function(e) {
                const items = dropdownList.querySelectorAll('.dropdown-item');
                if (e.key === 'ArrowDown') {
                    e.preventDefault();
                    currentFocus++;
                    if (currentFocus >= items.length) currentFocus = 0;
                    setActiveItem(items);
                } else if (e.key === 'ArrowUp') {
                    e.preventDefault();
                    currentFocus--;
                    if (currentFocus < 0) currentFocus = items.length - 1;
                    setActiveItem(items);
                } else if (e.key === 'Enter') {
                    e.preventDefault();
                    if (currentFocus > -1 && items[currentFocus]) {
                        items[currentFocus].click();
                    }
                } else if (e.key === 'Escape') {
                    dropdownList.style.display = 'none';
                    currentFocus = -1;
                }
            });

            function setActiveItem(items) {
                items.forEach((item, index) => {
                    if (index === currentFocus) {
                        item.classList.add('highlighted');
                    } else {
                        item.classList.remove('highlighted');
                    }
                });
            }

            // Close dropdown when clicking outside
            document.addEventListener('click', function(e) {
                if (!primaryFieldInput.contains(e.target) && !dropdownList.contains(e.target)) {
                    dropdownList.style.display = 'none';
                    currentFocus = -1;
                }
            });


            // Handle radio button and checkbox styling
            const radioItems = document.querySelectorAll('.radio-item');
            radioItems.forEach(item => {
                const input = item.querySelector('input[type="radio"], input[type="checkbox"]');
                if (input) {
                    input.addEventListener('change', function() {
                        if (input.type === 'radio') {
                            // Remove selected class from all radio buttons with same name
                            const radioGroup = document.querySelectorAll(`input[name="${input.name}"]`);
                            radioGroup.forEach(radio => {
                                radio.closest('.radio-item').classList.remove('selected');
                            });
                        }
                        
                        if (this.checked) {
                            item.classList.add('selected');
                        } else {
                            item.classList.remove('selected');
                        }



                    });
                }
            });

            // Business Benefits dropdown functionality
            const businessBenefitsCategories = {
                'שירות ומחירים': [
                    'הצעת מחיר מפורטת ללא התחייבות',
                    'המלצות חמות מלקוחות קיימים',
                    'ביקור ראשוני להערכת העבודה ללא תשלום',
                    'מחירים הוגנים ושקופים',
                    'יחס איכות-מחיר מעולה',
                    'תשלום מותאם לתקציב הלקוח',
                    'ללא עלויות נסתרות'
                ],
                'זמינות וגמישות': [
                    'זמינות מיידית לקריאות דחופות',
                    'שירות מהיר ואמין בכל שעה',
                    'תגובה מהירה לפניות ושאלות',
                    'גמישות מלאה בתיאום זמנים',
                    'אפשרות עבודה בסופי שבוע וחגים',
                    'התאמה ללוחות זמנים צמודים',
                    'זמינות לייעוץ וקבלת הנחיות'
                ],
                'ניסיון ומקצועיות': [
                    'ניסיון מוכח של שנים בתחום',
                    'צוות עובדים מקצועי ומיומן',
                    'שימוש בציוד מתקדם ואיכותי',
                    'עובדים קבועים עם ניסיון רב',
                    'מומחיות בפתרון בעיות מורכבות',
                    'השתלמויות מקצועיות שוטפות',
                    'הסמכות ורישיונות מקצועיים'
                ],
                'איכות ושירות': [
                    'ביצוע עבודה נקייה ומסודרת',
                    'שימוש בחומרים ורכיבים איכותיים בלבד',
                    'ניקיון יסודי של אתר העבודה בסיום',
                    'התחייבות מלאה לשביעות רצון הלקוח',
                    'שירות לקוחות אדיב ומקצועי',
                    'דיווח שוטף על התקדמות העבודה',
                    'אחריות מלאה על איכות הביצוע'
                ],
                'יעוץ ופתרונות': [
                    'ייעוץ מקצועי חינם לפני תחילת העבודה',
                    'פתרונות חכמים ויעילים לכל בעיה',
                    'התאמה אישית לצרכים הספציפיים',
                    'בדיקה ותכנון מקיפים מראש',
                    'הצעת חלופות וחיסכון בעלויות',
                    'ליווי וטיפול לאורך כל הפרויקט',
                    'שירות לאחר מכירה ותמיכה שוטפת'
                ]
            };

            // Business benefits functionality
            const minBusinessBenefits = 4;
            let selectedBusinessBenefits = [];
            
            const businessBenefitsDisplay = document.getElementById('businessBenefitsDisplay');
            const businessBenefitsDropdown = document.getElementById('businessBenefitsDropdown');
            const businessBenefitsPlaceholder = document.getElementById('businessBenefitsPlaceholder');

            // Specializations functionality
            const specializationsDisplay = document.getElementById('specializationsDisplay');
            const specializationsDropdown = document.getElementById('specializationsDropdown');
            const specializationsPlaceholder = document.getElementById('specializationsPlaceholder');

            function initializeBusinessBenefitsDropdown() {
                if (!businessBenefitsDropdown) {
                    console.error('businessBenefitsDropdown element not found!');
                    return;
                }
                businessBenefitsDropdown.innerHTML = '';
                
                // Add custom option input at the top
                const customInputContainer = document.createElement('div');
                customInputContainer.className = 'custom-restriction-container';
                customInputContainer.innerHTML = `
                    <div class="input-label">✨ הוסף יתרון בשפה חופשית</div>
                    <div class="custom-restriction-input-group">
                        <input type="text" placeholder="לדוגמה: מחזיר טלפונים תמיד..." class="custom-restriction-input">
                    </div>
                `;
                businessBenefitsDropdown.appendChild(customInputContainer);
                
                // Add event listeners for custom input
                const customInput = customInputContainer.querySelector('.custom-restriction-input');
                
                function addCustomBenefit() {
                    const customValue = customInput.value.trim();
                    if (customValue && !selectedBusinessBenefits.find(b => b.text === customValue)) {
                        selectedBusinessBenefits.push({
                            id: Date.now(),
                            text: customValue,
                            category: 'יתרון מותאם אישית',
                            isCustom: true
                        });
                        updateBusinessBenefitsDisplay();
                        customInput.value = '';
                        businessBenefitsDropdown.style.display = 'none';
                    }
                }
                
                customInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        addCustomBenefit();
                    }
                });
                
                customInput.addEventListener('blur', function() {
                    addCustomBenefit();
                });
                
                // Add categories
                Object.entries(businessBenefitsCategories).forEach(([category, benefits]) => {
                    const categoryHeader = document.createElement('div');
                    categoryHeader.className = 'category-header';
                    categoryHeader.style.cssText = 'padding: 12px 16px; background: #f3f4f6; font-weight: 600; color: #374151; border-bottom: 1px solid #e5e7eb;';
                    categoryHeader.textContent = category;
                    businessBenefitsDropdown.appendChild(categoryHeader);
                    
                    benefits.forEach(benefit => {
                        const item = document.createElement('div');
                        item.className = 'benefit-item';
                        item.style.cssText = 'padding: 12px 16px; cursor: pointer; border-bottom: 1px solid #f3f4f6; display: flex; align-items: center; gap: 12px;';
                        
                        const isSelected = selectedBusinessBenefits.find(b => b.text === benefit);
                        item.innerHTML = `
                            <div style="width: 18px; height: 18px; border: 2px solid #d1d5db; border-radius: 3px; display: flex; align-items: center; justify-content: center; ${isSelected ? 'background: #4f46e5; border-color: #4f46e5;' : ''}">
                                ${isSelected ? '<i class="fas fa-check" style="color: white; font-size: 12px;"></i>' : ''}
                            </div>
                            <span style="flex: 1; text-align: right; color: #374151;">${benefit}</span>
                        `;
                        
                        item.addEventListener('click', function(e) {
                            e.stopPropagation();
                            const existingIndex = selectedBusinessBenefits.findIndex(b => b.text === benefit);
                            
                            if (existingIndex >= 0) {
                                console.log(`DEBUG: Removing benefit: "${benefit}"`);
                                selectedBusinessBenefits.splice(existingIndex, 1);
                            } else {
                                console.log(`DEBUG: Adding benefit: "${benefit}" from category: "${category}"`);
                                selectedBusinessBenefits.push({
                                    id: Date.now(),
                                    text: benefit,
                                    category: category,
                                    isCustom: false
                                });
                            }
                            console.log(`DEBUG: selectedBusinessBenefits after change:`, selectedBusinessBenefits);
                            
                            updateBusinessBenefitsDisplay();
                            initializeBusinessBenefitsDropdown();
                        });
                        
                        item.addEventListener('mouseenter', function() {
                            this.style.backgroundColor = '#f9fafb';
                        });
                        
                        item.addEventListener('mouseleave', function() {
                            this.style.backgroundColor = 'white';
                        });
                        
                        businessBenefitsDropdown.appendChild(item);
                    });
                });
            }

            function updateBusinessBenefitsDisplay() {
                // Clear current display
                businessBenefitsDisplay.innerHTML = '';
                
                if (selectedBusinessBenefits.length === 0) {
                    businessBenefitsDisplay.appendChild(businessBenefitsPlaceholder);
                } else {
                    const countSpan = document.createElement('span');
                    const remainingNeeded = Math.max(0, minBusinessBenefits - selectedBusinessBenefits.length);
                    if (remainingNeeded > 0) {
                        countSpan.textContent = `נבחרו ${selectedBusinessBenefits.length} יתרונות (נדרש עוד ${remainingNeeded})`;
                        countSpan.style.color = '#dc2626';
                    } else {
                        countSpan.textContent = `נבחרו ${selectedBusinessBenefits.length} יתרונות`;
                        countSpan.style.color = '#059669';
                    }
                    businessBenefitsDisplay.appendChild(countSpan);
                }
                
                // Add chevron
                const chevron = document.createElement('i');
                chevron.className = 'fas fa-chevron-down';
                chevron.style.cssText = 'position: absolute; left: 16px; top: 16px; color: var(--text-muted);';
                businessBenefitsDisplay.appendChild(chevron);
                
                // Update separate tags display
                updateBusinessBenefitsTags();
                
                // Sync form data - remove ALL existing business_benefits[] inputs first
                const form = document.querySelector('form');
                const existingInputs = form.querySelectorAll('input[name="business_benefits[]"]');
                existingInputs.forEach(input => input.remove());
                
                // Add hidden inputs for each selected benefit
                selectedBusinessBenefits.forEach((benefit, index) => {
                    const hiddenInput = document.createElement('input');
                    hiddenInput.type = 'hidden';
                    hiddenInput.name = 'business_benefits[]';
                    hiddenInput.value = benefit.text;
                    hiddenInput.setAttribute('data-debug', `sync-input-${index}`);
                    form.appendChild(hiddenInput);
                    console.log(`DEBUG: Created sync input ${index}: "${benefit.text}"`);
                });
            }
            
            function updateBusinessBenefitsTags() {
                const businessBenefitsTags = document.getElementById('businessBenefitsTags');
                businessBenefitsTags.innerHTML = '';
                
                // Group benefits by category
                const benefitsByCategory = {};
                selectedBusinessBenefits.forEach(benefit => {
                    const categoryName = benefit.category || 'יתרון מותאם אישית';
                    if (!benefitsByCategory[categoryName]) {
                        benefitsByCategory[categoryName] = [];
                    }
                    benefitsByCategory[categoryName].push(benefit);
                });
                
                // Create display for each category
                Object.keys(benefitsByCategory).forEach(categoryName => {
                    const categoryContainer = document.createElement('div');
                    categoryContainer.style.cssText = 'margin-bottom: 24px;';
                    
                    // Create category header (only once per category)
                    const categoryHeader = document.createElement('div');
                    categoryHeader.style.cssText = `
                        font-weight: 600;
                        color: #374151;
                        font-size: 14px;
                        margin-bottom: 12px;
                        padding: 8px 0;
                        border-bottom: 1px solid #e5e7eb;
                    `;
                    categoryHeader.textContent = categoryName;
                    categoryContainer.appendChild(categoryHeader);
                    
                    // Create input for each benefit in this category
                    benefitsByCategory[categoryName].forEach(benefit => {
                        const inputContainer = document.createElement('div');
                        inputContainer.style.cssText = 'position: relative; margin-bottom: 12px;';
                        
                        const textInput = document.createElement('input');
                        textInput.type = 'text';
                        textInput.value = benefit.text;
                        textInput.className = 'form-input business-benefit-input';
                        textInput.style.padding = '12px 16px 12px 40px';
                        textInput.style.fontSize = '14px';
                        textInput.style.textAlign = 'right';
                        textInput.style.direction = 'rtl';
                        textInput.placeholder = 'הכנס את תיאור היתרון...';
                        
                        // Update benefit text when input changes
                        textInput.addEventListener('input', function() {
                            benefit.text = this.value.trim();
                        });
                        
                        // Create remove button
                        const removeBtn = document.createElement('button');
                        removeBtn.type = 'button';
                        removeBtn.innerHTML = '×';
                        removeBtn.style.cssText = `
                            position: absolute;
                            top: 50%;
                            left: 12px;
                            transform: translateY(-50%);
                            background: none;
                            border: none;
                            font-size: 18px;
                            font-weight: bold;
                            color: #dc2626;
                            cursor: pointer;
                            width: 24px;
                            height: 24px;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            border-radius: 50%;
                            transition: background-color 0.2s;
                        `;
                        
                        removeBtn.addEventListener('click', function() {
                            selectedBusinessBenefits = selectedBusinessBenefits.filter(b => b.id !== benefit.id);
                            updateBusinessBenefitsDisplay();
                        });
                        
                        removeBtn.addEventListener('mouseenter', function() {
                            this.style.backgroundColor = 'rgba(220, 38, 38, 0.1)';
                        });
                        
                        removeBtn.addEventListener('mouseleave', function() {
                            this.style.backgroundColor = 'transparent';
                        });
                        
                        // Focus styling
                        textInput.addEventListener('focus', function() {
                            this.style.borderColor = 'var(--ai-purple)';
                            this.style.outline = '0 0 0 3px rgba(79, 70, 229, 0.1)';
                        });
                        
                        textInput.addEventListener('blur', function() {
                            this.style.borderColor = 'var(--border-light)';
                            this.style.outline = 'none';
                        });
                        
                        inputContainer.appendChild(textInput);
                        inputContainer.appendChild(removeBtn);
                        categoryContainer.appendChild(inputContainer);
                    });
                    
                    businessBenefitsTags.appendChild(categoryContainer);
                });
                
                // Validate minimum benefits
                const form = document.querySelector('.contact-form');
                if (form) {
                    const submitBtn = form.querySelector('button[type="submit"]');
                    if (submitBtn) {
                        if (selectedBusinessBenefits.length < minBusinessBenefits) {
                            submitBtn.style.opacity = '0.6';
                            submitBtn.title = `נדרש לבחור לפחות ${minBusinessBenefits} יתרונות עסקיים`;
                        } else {
                            submitBtn.style.opacity = '1';
                            submitBtn.title = '';
                        }
                    }
                }
            }

            // Specializations dropdown functionality
            function initializeSpecializationsDropdown() {
                if (!specializationsDropdown) {
                    console.error('specializationsDropdown element not found!');
                    return;
                }
                
                // Clear dropdown
                specializationsDropdown.innerHTML = '';
                
                // Add search input at the top
                const searchContainer = document.createElement('div');
                searchContainer.style.cssText = 'padding: 12px; border-bottom: 1px solid #e5e7eb; background: #f9fafb;';
                searchContainer.innerHTML = `
                    <input type="text" placeholder="חיפוש התמחויות..." style="width: 100%; padding: 8px 12px; border: 1px solid #d1d5db; border-radius: 4px; font-size: 14px; text-align: right;" id="specializationsSearch">
                `;
                specializationsDropdown.appendChild(searchContainer);
                
                // Create categories
                Object.keys(specializations).forEach(category => {
                    const categoryDiv = document.createElement('div');
                    categoryDiv.style.cssText = 'border-bottom: 1px solid #f3f4f6;';
                    
                    // Category header with checkbox to select all
                    const categoryHeader = document.createElement('div');
                    categoryHeader.style.cssText = 'padding: 12px 16px; background: #f8fafc; font-weight: 600; color: #374151; display: flex; align-items: center; cursor: pointer; border-bottom: 1px solid #e5e7eb;';
                    
                    const allSelected = specializations[category].every(spec => 
                        selectedSpecializations.find(s => s.text === spec && s.category === category)
                    );
                    
                    categoryHeader.innerHTML = `
                        <div style="width: 18px; height: 18px; border: 2px solid #d1d5db; border-radius: 3px; display: flex; align-items: center; justify-content: center; margin-left: 12px; ${allSelected ? 'background: #4f46e5; border-color: #4f46e5;' : ''}">
                            ${allSelected ? '<i class="fas fa-check" style="color: white; font-size: 10px;"></i>' : ''}
                        </div>
                        <span>${category} - בחירת הכל</span>
                    `;
                    
                    // Toggle all specializations in category
                    categoryHeader.addEventListener('click', function(e) {
                        e.stopPropagation();
                        const checkbox = this.querySelector('div');
                        const isAllSelected = specializations[category].every(spec => 
                            selectedSpecializations.find(s => s.text === spec && s.category === category)
                        );
                        
                        if (isAllSelected) {
                            // Remove all from this category
                            selectedSpecializations = selectedSpecializations.filter(s => s.category !== category);
                        } else {
                            // Add all from this category
                            selectedSpecializations = selectedSpecializations.filter(s => s.category !== category);
                            specializations[category].forEach(spec => {
                                selectedSpecializations.push({
                                    id: Date.now() + Math.random(),
                                    text: spec,
                                    category: category,
                                    isCustom: false
                                });
                            });
                        }
                        
                        updateSpecializationsDisplay();
                        initializeSpecializationsDropdown();
                    });
                    
                    categoryDiv.appendChild(categoryHeader);
                    
                    // Custom input for this category
                    const customInputContainer = document.createElement('div');
                    customInputContainer.style.cssText = 'padding: 8px 16px; background: #fefefe; border-bottom: 1px solid #f0f0f0;';
                    customInputContainer.innerHTML = `
                        <div style="display: flex; gap: 8px; align-items: center;">
                            <input type="text" placeholder="הוסיפו התמחות מותאמת ב${category}..." style="width: 80%; padding: 6px 10px; border: 1px solid #d1d5db; border-radius: 4px; font-size: 13px; text-align: right;" class="custom-specialization-input">
                            <button type="button" style="width: 20%; padding: 6px 4px; background: #3b82f6; color: white; border: none; border-radius: 4px; font-size: 12px; cursor: pointer;" class="add-custom-specialization">הוסף</button>
                        </div>
                    `;
                    
                    const customInput = customInputContainer.querySelector('.custom-specialization-input');
                    const addBtn = customInputContainer.querySelector('.add-custom-specialization');
                    
                    function addCustomSpecialization() {
                        const customValue = customInput.value.trim();
                        if (customValue && !selectedSpecializations.find(s => s.text === customValue)) {
                            selectedSpecializations.push({
                                id: Date.now(),
                                text: customValue,
                                category: category,
                                isCustom: true
                            });
                            customInput.value = '';
                            updateSpecializationsDisplay();
                            initializeSpecializationsDropdown();
                        }
                    }
                    
                    addBtn.addEventListener('click', addCustomSpecialization);
                    customInput.addEventListener('keypress', function(e) {
                        if (e.key === 'Enter') {
                            e.preventDefault();
                            addCustomSpecialization();
                        }
                    });
                    
                    categoryDiv.appendChild(customInputContainer);
                    
                    // Individual specializations
                    specializations[category].forEach(specialization => {
                        const item = document.createElement('div');
                        item.style.cssText = 'padding: 10px 16px; cursor: pointer; border-bottom: 1px solid #f9fafb; display: flex; align-items: center; gap: 12px;';
                        
                        const isSelected = selectedSpecializations.find(s => s.text === specialization && s.category === category);
                        item.innerHTML = `
                            <div style="width: 18px; height: 18px; border: 2px solid #d1d5db; border-radius: 3px; display: flex; align-items: center; justify-content: center; ${isSelected ? 'background: #4f46e5; border-color: #4f46e5;' : ''}">
                                ${isSelected ? '<i class="fas fa-check" style="color: white; font-size: 10px;"></i>' : ''}
                            </div>
                            <span style="flex: 1; text-align: right;">${specialization}</span>
                        `;
                        
                        item.addEventListener('click', function(e) {
                            e.stopPropagation();
                            const existingIndex = selectedSpecializations.findIndex(s => s.text === specialization && s.category === category);
                            
                            if (existingIndex >= 0) {
                                selectedSpecializations.splice(existingIndex, 1);
                            } else {
                                selectedSpecializations.push({
                                    id: Date.now(),
                                    text: specialization,
                                    category: category,
                                    isCustom: false
                                });
                            }
                            
                            updateSpecializationsDisplay();
                            initializeSpecializationsDropdown();
                        });
                        
                        item.addEventListener('mouseenter', function() {
                            this.style.backgroundColor = '#f3f4f6';
                        });
                        
                        item.addEventListener('mouseleave', function() {
                            this.style.backgroundColor = '';
                        });
                        
                        categoryDiv.appendChild(item);
                    });
                    
                    specializationsDropdown.appendChild(categoryDiv);
                });
                
                // Search functionality
                const searchInput = specializationsDropdown.querySelector('#specializationsSearch');
                if (searchInput) {
                    searchInput.addEventListener('input', function() {
                        const searchTerm = this.value.toLowerCase();
                        const categoryDivs = specializationsDropdown.querySelectorAll('div[style*="border-bottom: 1px solid #f3f4f6"]');
                        
                        categoryDivs.forEach(categoryDiv => {
                            const categoryName = categoryDiv.querySelector('span').textContent.replace(' - בחירת הכל', '');
                            const specializationItems = categoryDiv.querySelectorAll('div[style*="padding: 10px 16px"]');
                            let hasVisibleItems = false;
                            
                            if (categoryName.toLowerCase().includes(searchTerm)) {
                                categoryDiv.style.display = 'block';
                                hasVisibleItems = true;
                            } else {
                                specializationItems.forEach(item => {
                                    const text = item.textContent.toLowerCase();
                                    if (text.includes(searchTerm)) {
                                        item.style.display = 'flex';
                                        hasVisibleItems = true;
                                    } else {
                                        item.style.display = 'none';
                                    }
                                });
                                categoryDiv.style.display = hasVisibleItems ? 'block' : 'none';
                            }
                        });
                    });
                }
            }

            function updateSpecializationsDisplay() {
                // Clear current display
                specializationsDisplay.innerHTML = '';
                
                if (selectedSpecializations.length === 0) {
                    specializationsDisplay.appendChild(specializationsPlaceholder);
                } else {
                    const countSpan = document.createElement('span');
                    countSpan.textContent = `נבחרו ${selectedSpecializations.length} התמחויות נוספות`;
                    countSpan.style.color = '#059669';
                    specializationsDisplay.appendChild(countSpan);
                }
                
                // Add chevron
                const chevron = document.createElement('i');
                chevron.className = 'fas fa-chevron-down';
                chevron.style.cssText = 'position: absolute; left: 16px; top: 16px; color: var(--text-muted);';
                specializationsDisplay.appendChild(chevron);
                
                // Update separate tags display
                updateSpecializationsTags();
                
                // Sync form data - remove existing hidden inputs first
                const form = document.querySelector('form');
                const existingInputs = form.querySelectorAll('input[name="specializations[]"]');
                existingInputs.forEach(input => input.remove());
                
                // Add hidden inputs for each selected specialization
                selectedSpecializations.forEach((specialization, index) => {
                    const hiddenInput = document.createElement('input');
                    hiddenInput.type = 'hidden';
                    hiddenInput.name = 'specializations[]';
                    hiddenInput.value = JSON.stringify({
                        text: specialization.text,
                        category: specialization.category,
                        isCustom: specialization.isCustom
                    });
                    hiddenInput.setAttribute('data-debug', `specialization-input-${index}`);
                    form.appendChild(hiddenInput);
                });
            }

            function updateSpecializationsTags() {
                const specializationsTags = document.getElementById('specializationsTags');
                if (!specializationsTags) return;
                
                specializationsTags.innerHTML = '';
                
                if (selectedSpecializations.length === 0) return;
                
                // Group specializations by category
                const specializationsByCategory = {};
                selectedSpecializations.forEach(specialization => {
                    const categoryName = specialization.category || 'התמחויות מותאמות';
                    if (!specializationsByCategory[categoryName]) {
                        specializationsByCategory[categoryName] = [];
                    }
                    specializationsByCategory[categoryName].push(specialization);
                });
                
                // Create display for each category
                Object.keys(specializationsByCategory).forEach(categoryName => {
                    const categoryContainer = document.createElement('div');
                    categoryContainer.style.cssText = 'margin-bottom: 24px;';
                    
                    // Create category header
                    const categoryHeader = document.createElement('div');
                    categoryHeader.style.cssText = `
                        font-weight: 600;
                        color: #374151;
                        font-size: 14px;
                        margin-bottom: 12px;
                        padding: 8px 0;
                        border-bottom: 1px solid #e5e7eb;
                    `;
                    categoryHeader.textContent = `${categoryName} (${specializationsByCategory[categoryName].length})`;
                    categoryContainer.appendChild(categoryHeader);
                    
                    // Create tags for each specialization in this category
                    specializationsByCategory[categoryName].forEach(specialization => {
                        const tagContainer = document.createElement('div');
                        tagContainer.style.cssText = 'display: inline-block; margin: 4px 8px 4px 0;';
                        
                        const tag = document.createElement('span');
                        tag.style.cssText = `
                            display: inline-flex;
                            align-items: center;
                            padding: 6px 12px;
                            background: ${specialization.isCustom ? '#f0f9ff' : '#f3f4f6'};
                            border: 1px solid ${specialization.isCustom ? '#0ea5e9' : '#d1d5db'};
                            border-radius: 20px;
                            font-size: 13px;
                            color: ${specialization.isCustom ? '#0c4a6e' : '#374151'};
                            gap: 8px;
                        `;
                        
                        tag.innerHTML = `
                            <span>${specialization.text}</span>
                            <i class="fas fa-times" style="cursor: pointer; opacity: 0.7;" title="הסר התמחות"></i>
                        `;
                        
                        // Remove specialization on click
                        tag.querySelector('.fa-times').addEventListener('click', function() {
                            selectedSpecializations = selectedSpecializations.filter(s => s.id !== specialization.id);
                            updateSpecializationsDisplay();
                        });
                        
                        tagContainer.appendChild(tag);
                        categoryContainer.appendChild(tagContainer);
                    });
                    
                    specializationsTags.appendChild(categoryContainer);
                });
            }

            // Initialize dropdown with a small delay to ensure DOM is ready
            setTimeout(function() {
                initializeBusinessBenefitsDropdown();
                initializeSpecializationsDropdown();
            }, 100);

            // Handle dropdown toggle
            if (businessBenefitsDisplay && businessBenefitsDropdown) {
                businessBenefitsDisplay.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    const isVisible = businessBenefitsDropdown.style.display === 'block';
                    businessBenefitsDropdown.style.display = isVisible ? 'none' : 'block';
                });
            } else {
                console.error('Business benefits elements not found:', {
                    display: !!businessBenefitsDisplay,
                    dropdown: !!businessBenefitsDropdown
                });
            }

            // Handle specializations dropdown toggle
            if (specializationsDisplay && specializationsDropdown) {
                specializationsDisplay.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    const isVisible = specializationsDropdown.style.display === 'block';
                    specializationsDropdown.style.display = isVisible ? 'none' : 'block';
                });
            }

            // Close dropdowns when clicking outside
            document.addEventListener('click', function(e) {
                const businessBenefitsContainer = document.getElementById('businessBenefitsContainer');
                const specializationsContainer = document.getElementById('specializationsContainer');
                
                if (businessBenefitsContainer && !businessBenefitsContainer.contains(e.target)) {
                    businessBenefitsDropdown.style.display = 'none';
                }
                
                if (specializationsContainer && !specializationsContainer.contains(e.target)) {
                    specializationsDropdown.style.display = 'none';
                }
            });

            // Restriction dropdown functionality
            const restrictionOptions = [
                'מחירים ספציפיים',
                'פרטים אישיים של לקוחות',
                'ביקורת על מתחרים',
                'נושאים פוליטיים',
                'מידע פיננסי',
                'עבודות שלא בתחום התמחות',
                'המלצות על חברות אחרות',
                'נושאי דת',
                'תלונות על לקוחות',
                'סודות מקצועיים'
            ];

            const restrictionSelect = document.getElementById('restrictionSelect');
            const restrictionDropdown = document.getElementById('restrictionDropdown');
            const restrictionTags = document.getElementById('restrictionTags');
            let selectedRestrictions = [];
            const maxRestrictions = 5;

            function initializeRestrictionsDropdown() {
                // Clear dropdown
                restrictionDropdown.innerHTML = '';

                // Add custom option input at the top
                const customInputContainer = document.createElement('div');
                customInputContainer.className = 'custom-restriction-container';
                customInputContainer.innerHTML = `
                    <div class="input-label">✨ הוסף נושא בשפה חופשית</div>
                    <div class="custom-restriction-input-group">
                        <input type="text" placeholder="לדוגמה: לא לדבר על פרויקטים ישנים..." class="custom-restriction-input">
                    </div>
                `;
                restrictionDropdown.appendChild(customInputContainer);
                
                // Add event listeners for custom input
                const customInput = customInputContainer.querySelector('.custom-restriction-input');
                
                function addCustomRestriction() {
                    const customValue = customInput.value.trim();
                    if (customValue && selectedRestrictions.length < maxRestrictions && !selectedRestrictions.includes(customValue)) {
                        selectedRestrictions.push(customValue);
                        updateRestrictionsDisplay();
                        updateRestrictionDropdownStates();
                        customInput.value = '';
                        restrictionDropdown.style.display = 'none';
                    }
                }
                
                customInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        addCustomRestriction();
                    }
                });
                
                // Add predefined options with clickable containers
                restrictionOptions.forEach((option) => {
                    const item = document.createElement('div');
                    item.className = 'restriction-item';
                    item.style.cssText = 'padding: 12px 16px; cursor: pointer; border-bottom: 1px solid #f3f4f6; display: flex; align-items: center; gap: 12px; transition: background-color 0.2s ease;';
                    
                    // Add hover effects
                    item.addEventListener('mouseenter', function() {
                        if (!selectedRestrictions.includes(option) || selectedRestrictions.length < maxRestrictions) {
                            this.style.backgroundColor = '#f9fafb';
                        }
                    });
                    
                    item.addEventListener('mouseleave', function() {
                        this.style.backgroundColor = '';
                    });
                    
                    const isSelected = selectedRestrictions.includes(option);
                    item.innerHTML = `
                        <div style="width: 18px; height: 18px; border: 2px solid #d1d5db; border-radius: 3px; display: flex; align-items: center; justify-content: center; ${isSelected ? 'background: #4f46e5; border-color: #4f46e5;' : ''}">
                            ${isSelected ? '<i class="fas fa-check" style="color: white; font-size: 12px;"></i>' : ''}
                        </div>
                        <span style="flex: 1; text-align: right; color: #374151;">${option}</span>
                    `;
                    
                    item.addEventListener('click', function(e) {
                        e.stopPropagation();
                        const existingIndex = selectedRestrictions.indexOf(option);
                        
                        if (existingIndex >= 0) {
                            // Remove restriction
                            selectedRestrictions.splice(existingIndex, 1);
                        } else if (selectedRestrictions.length < maxRestrictions) {
                            // Add restriction
                            selectedRestrictions.push(option);
                        }
                        
                        updateRestrictionsDisplay();
                        updateRestrictionDropdownStates();
                    });
                    
                    restrictionDropdown.appendChild(item);
                });
            }

            function updateRestrictionsDisplay() {
                // Clear current display
                restrictionTags.innerHTML = '';
                
                if (selectedRestrictions.length > 0) {
                    selectedRestrictions.forEach((restriction, index) => {
                        const inputContainer = document.createElement('div');
                        inputContainer.style.cssText = 'position: relative; margin-bottom: 12px;';
                        
                        const textInput = document.createElement('input');
                        textInput.type = 'text';
                        textInput.value = restriction;
                        textInput.name = 'restrictions[]';
                        textInput.className = 'form-input restriction-input';
                        textInput.style.padding = '12px 16px 12px 40px';
                        textInput.style.fontSize = '14px';
                        textInput.style.textAlign = 'right';
                        textInput.style.direction = 'rtl';
                        textInput.placeholder = 'הכנס את תיאור ההגבלה...';
                        
                        // Update restriction text when input changes
                        textInput.addEventListener('input', function() {
                            selectedRestrictions[index] = this.value.trim();
                        });
                        
                        textInput.addEventListener('focus', function() {
                            this.style.borderColor = 'var(--ai-purple)';
                            this.style.boxShadow = '0 0 0 3px rgba(79, 70, 229, 0.1)';
                        });
                        
                        textInput.addEventListener('blur', function() {
                            this.style.borderColor = 'var(--border-light)';
                            this.style.outline = 'none';
                        });
                        
                        const removeBtn = document.createElement('button');
                        removeBtn.type = 'button';
                        removeBtn.innerHTML = '×';
                        removeBtn.style.cssText = 'position: absolute; left: 12px; top: 50%; transform: translateY(-50%); background: none; border: none; color: #9ca3af; cursor: pointer; font-size: 18px; font-weight: bold; padding: 0; width: 20px; height: 20px; display: flex; align-items: center; justify-content: center;';
                        
                        removeBtn.addEventListener('click', function() {
                            selectedRestrictions = selectedRestrictions.filter((_, i) => i !== index);
                            updateRestrictionsDisplay();
                            updateRestrictionDropdownStates();
                        });
                        
                        inputContainer.appendChild(textInput);
                        inputContainer.appendChild(removeBtn);
                        restrictionTags.appendChild(inputContainer);
                    });
                }
            }

            function updateRestrictionDropdownStates() {
                const restrictionItems = restrictionDropdown.querySelectorAll('.restriction-item');
                restrictionItems.forEach(item => {
                    const optionText = item.querySelector('span').textContent;
                    const isSelected = selectedRestrictions.includes(optionText);
                    const checkboxContainer = item.querySelector('div');
                    
                    // Update visual state
                    if (isSelected) {
                        checkboxContainer.style.background = '#4f46e5';
                        checkboxContainer.style.borderColor = '#4f46e5';
                        checkboxContainer.innerHTML = '<i class="fas fa-check" style="color: white; font-size: 12px;"></i>';
                    } else {
                        checkboxContainer.style.background = '';
                        checkboxContainer.style.borderColor = '#d1d5db';
                        checkboxContainer.innerHTML = '';
                    }
                    
                    // Disable if max reached and not selected
                    if (!isSelected && selectedRestrictions.length >= maxRestrictions) {
                        item.style.opacity = '0.5';
                        item.style.cursor = 'not-allowed';
                        // Remove hover effect when disabled
                        item.onmouseenter = null;
                        item.onmouseleave = null;
                    } else {
                        item.style.opacity = '1';
                        item.style.cursor = 'pointer';
                        // Re-add hover effects when enabled
                        item.onmouseenter = function() {
                            this.style.backgroundColor = '#f9fafb';
                        };
                        item.onmouseleave = function() {
                            this.style.backgroundColor = '';
                        };
                    }
                });
            }

            // Initialize restriction dropdown
            initializeRestrictionsDropdown();

            restrictionSelect.addEventListener('click', function(e) {
                e.preventDefault();
                if (restrictionDropdown.style.display === 'block') {
                    restrictionDropdown.style.display = 'none';
                } else {
                    restrictionDropdown.style.display = 'block';
                    updateRestrictionDropdownStates();
                }
            });

            // הוספת תמיכה במקלדת להגבלות
            restrictionSelect.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    restrictionSelect.click();
                }
            });

            // Close dropdown when clicking outside
            document.addEventListener('click', function(e) {
                if (!restrictionSelect.contains(e.target) && !restrictionDropdown.contains(e.target)) {
                    restrictionDropdown.style.display = 'none';
                }
            });

            // Work area dropdown functionality
            const workAreaOptions = [
                'צפון',
                'השרון', 
                'מרכז',
                'ירושלים והסביבה',
                'דרום',
                'אילת',
                'כל הארץ'
            ];

            const workAreaSelect = document.getElementById('workAreaSelect');
            const workAreaDropdown = document.getElementById('workAreaDropdown');
            const workAreaTags = document.getElementById('workAreaTags');
            let selectedWorkAreas = [];

            function initializeWorkAreaDropdown() {
                // Clear dropdown
                workAreaDropdown.innerHTML = '';
                
                // Add predefined options with checkboxes
                workAreaOptions.forEach((option) => {
                    const item = document.createElement('div');
                    item.className = 'work-area-checkbox-item';
                    item.style.cursor = 'pointer';
                    item.innerHTML = `
                        <input type="checkbox" value="${option}" id="work_area_${option.replace(/\s+/g, '_')}">
                        <label for="work_area_${option.replace(/\s+/g, '_')}">${option}</label>
                    `;
                    
                    const checkbox = item.querySelector('input[type="checkbox"]');
                    
                    // Make the entire item clickable
                    item.addEventListener('click', function(e) {
                        // Prevent double triggering when clicking directly on checkbox
                        if (e.target.type !== 'checkbox') {
                            checkbox.checked = !checkbox.checked;
                            checkbox.dispatchEvent(new Event('change'));
                        }
                    });
                    
                    checkbox.addEventListener('change', function() {
                        if (this.checked) {
                            selectedWorkAreas.push(option);
                            updateWorkAreaDisplay();
                            updateWorkAreaDropdownStates();
                        } else {
                            selectedWorkAreas = selectedWorkAreas.filter(area => area !== option);
                            updateWorkAreaDisplay();
                            updateWorkAreaDropdownStates();
                        }
                        // Close dropdown after selection
                        workAreaDropdown.style.display = 'none';
                    });
                    
                    workAreaDropdown.appendChild(item);
                });
            }

            function updateWorkAreaDisplay() {
                // Clear current display
                workAreaTags.innerHTML = '';
                
                if (selectedWorkAreas.length > 0) {
                    selectedWorkAreas.forEach(area => {
                        const tag = document.createElement('div');
                        tag.className = 'work-area-tag';
                        tag.innerHTML = `
                            <span>${area}</span>
                            <span class="remove-tag">×</span>
                        `;
                        
                        tag.querySelector('.remove-tag').addEventListener('click', function(e) {
                            e.stopPropagation();
                            selectedWorkAreas = selectedWorkAreas.filter(wa => wa !== area);
                            updateWorkAreaDisplay();
                            updateWorkAreaDropdownStates();
                        });
                        
                        workAreaTags.appendChild(tag);
                    });
                }
            }

            function updateWorkAreaDropdownStates() {
                const checkboxes = workAreaDropdown.querySelectorAll('input[type="checkbox"]');
                checkboxes.forEach(checkbox => {
                    checkbox.checked = selectedWorkAreas.includes(checkbox.value);
                });
            }

            // Initialize work area dropdown
            initializeWorkAreaDropdown();

            workAreaSelect.addEventListener('click', function(e) {
                e.preventDefault();
                if (workAreaDropdown.style.display === 'block') {
                    workAreaDropdown.style.display = 'none';
                } else {
                    workAreaDropdown.style.display = 'block';
                    updateWorkAreaDropdownStates();
                }
            });

            // הוספת תמיכה במקלדת לאזורי עבודה
            workAreaSelect.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    workAreaSelect.click();
                }
            });

            // Close dropdown when clicking outside
            document.addEventListener('click', function(e) {
                if (!workAreaSelect.contains(e.target) && !workAreaDropdown.contains(e.target)) {
                    workAreaDropdown.style.display = 'none';
                }
            });



            // Form submission
            document.getElementById('clientForm').addEventListener('submit', async function(e) {
                e.preventDefault();
                
                // Collect form data
                const formData = new FormData(this);
                const data = {};
                
                for (let [key, value] of formData.entries()) {
                    if (key === 'work_area' || key === 'business_benefits[]' || key === 'specializations[]') {
                        // Handle multiple values for these fields
                        if (!data[key]) {
                            data[key] = [];
                        }
                        data[key].push(value);
                    } else {
                        data[key] = value;
                    }
                }
                
                // Validate business benefits minimum requirement
                const businessBenefits = data['business_benefits[]'] || [];
                const businessBenefitsArray = Array.isArray(businessBenefits) ? businessBenefits : [businessBenefits];
                const validBenefits = businessBenefitsArray.filter(b => b && b.trim());
                
                // DEBUG: Log detailed validation info
                console.log('=== BUSINESS BENEFITS DEBUG ===');
                console.log('selectedBusinessBenefits array:', selectedBusinessBenefits);
                console.log('selectedBusinessBenefits.length:', selectedBusinessBenefits.length);
                console.log('Raw form data business_benefits[]:', data['business_benefits[]']);
                console.log('businessBenefitsArray:', businessBenefitsArray);
                console.log('validBenefits after filter:', validBenefits);
                console.log('validBenefits.length:', validBenefits.length);
                console.log('All form data keys:', Object.keys(data));
                console.log('All hidden inputs with name business_benefits[]:', 
                    document.querySelectorAll('input[name="business_benefits[]"]'));
                console.log('================================');
                
                if (validBenefits.length < 4) {
                    alert(`נדרש לבחור לפחות 4 יתרונות עסקיים. נמצאו ${validBenefits.length} יתרונות: ${validBenefits.join(', ')}`);
                    const businessBenefitsDisplay = document.getElementById('businessBenefitsDisplay');
                    if (businessBenefitsDisplay) {
                        businessBenefitsDisplay.scrollIntoView({ behavior: 'smooth' });
                        businessBenefitsDisplay.style.borderColor = '#dc2626';
                        setTimeout(() => {
                            businessBenefitsDisplay.style.borderColor = '';
                        }, 3000);
                    }
                    return;
                }
                
                // Fix field name mapping
                if (data.work_area) {
                    data.work_areas = data.work_area;
                    delete data.work_area;
                }
                
                // הוספת השדות החסרים
                // שאלה 5 - אזורי העבודה
                data.work_areas = selectedWorkAreas;


                // שאלה 7 - הגבלות
                data.restrictions = selectedRestrictions;

                // Format phone number to 9725XXXXXXXX
                if (data.phone_number) {
                    data.phone_number = formatPhoneNumber(data.phone_number);
                }
                
                // Process specializations data
                if (data['specializations[]']) {
                    const specializationsData = data['specializations[]'].map(spec => {
                        try {
                            return JSON.parse(spec);
                        } catch (e) {
                            return { text: spec, category: 'אחר', isCustom: false };
                        }
                    });
                    data.specializations = specializationsData;
                } else {
                    data.specializations = [];
                }
                
                try {
                    // יצירת System Prompt JSON מהטמפלט הקיים
                    const generator = new SimpleFormToPrompt();
                    const result = await generator.generateJSONFile(data);
                    
                    alert(`System Prompt JSON נוצר בהצלחה! 
📄 שם הקובץ: ${result.fileName}
👤 בעל המקצוע: ${data.name || 'לא צוין'}
🔧 תחום: ${data.primary_field || 'לא צוין'}
📊 גודל: ${Math.round(result.size / 1024)} KB
                    
הקובץ JSON כולל:
• System Prompt מלא עם הפרטים שלך כבר מוחלפים
• הטמפלט המקצועי עם השם והפרטים שלך
• מוכן להעתקה ישירה ל-ChatGPT/Claude!
• ללא פליסהולדרים - הכל מוחלף בפרטים האמיתיים!`);
                    
                } catch (error) {
                    console.error('שגיאה ביצירת System Prompt JSON:', error);
                    
                    // Fallback - הורדת JSON כמו קודם
                    const jsonData = JSON.stringify(data, null, 2);
                    const blob = new Blob([jsonData], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `client_data_${new Date().toISOString().split('T')[0]}.json`;
                    a.click();
                    
                    alert('שגיאה ביצירת System Prompt JSON. הטופס נשמר כקובץ נתונים רגיל במקום.');
                }
                
                // Reset form
                this.reset();
                
                // Remove all selected classes
                radioItems.forEach(item => {
                    item.classList.remove('selected');
                });
                
                // Reset business benefits
                selectedBusinessBenefits = [];
                updateBusinessBenefitsDisplay();
                
                // Reset specializations
                selectedSpecializations = [];
                updateSpecializationsDisplay();
                
                // Reset work areas if they exist
                if (typeof selectedWorkAreas !== 'undefined') {
                    selectedWorkAreas = [];
                    if (typeof updateWorkAreaDisplay === 'function') {
                        updateWorkAreaDisplay();
                    }
                }
                
                // Clear any error styles
                const businessBenefitsDisplay = document.getElementById('businessBenefitsDisplay');
                if (businessBenefitsDisplay) {
                    businessBenefitsDisplay.style.borderColor = '';
                }
                
                console.log('DEBUG: Form reset completed - all arrays and displays cleared');
            });

        }); // End of DOMContentLoaded

        // Live Preview System
        class LivePreviewSystem {
            constructor() {
                this.initializePreview();
            }

            initializePreview() {
                const generateBtn = document.getElementById('generatePreviewBtn');
                if (generateBtn) {
                    generateBtn.addEventListener('click', () => this.generatePreview());
                }

                // Show preview section when form is mostly filled
                this.watchFormProgress();
            }

            watchFormProgress() {
                const requiredFields = ['client_name', 'primary_field', 'experience_years', 'phone_number'];
                const previewSection = document.getElementById('livePreviewSection');
                
                setInterval(() => {
                    const filledFields = requiredFields.filter(fieldName => {
                        const field = document.querySelector(`[name="${fieldName}"]`);
                        return field && field.value.trim() !== '';
                    });

                    // Check business benefits from the display
                    const businessBenefitsDisplay = document.getElementById('businessBenefitsDisplay');
                    const businessBenefitsFilled = businessBenefitsDisplay && 
                        businessBenefitsDisplay.children.length >= 4;
                    
                    if (filledFields.length >= 3 && businessBenefitsFilled) {
                        previewSection.style.display = 'block';
                    }
                }, 1000);
            }

            generateSamplePosts(primaryField, workAreas) {
                const postTemplates = {
                    'חשמל': [
                        'שלום, אני צריך חשמלאי בדחיפות! יש לי בעיה עם הלוח חשמל ונופל לי המגן. מישהו יכול להגיע היום?',
                        'מחפש חשמלאי להתקנת נקודות חשמל בבית החדש. יש לי 5 חדרים. מישהו יכול לתת הערכת מחיר?',
                        'היי! דרוש חשמלאי לתיקון בעיית תאורה בסלון. הנורות נדלקות ומכבות מעצמן. מישהו פנוי?'
                    ],
                    'אינסטלציה': [
                        'עזרה! יש לי דלפת מים חזקה מהברז במטבח. מישהו יכול להגיע עכשיו?',
                        'מחפש אינסטלטור לבדיקת לחץ מים בבית. המים זורמים חלש מאוד. מישהו יכול לעזור?',
                        'צריך התקנת אינסטלציה חדשה לחדר רחצה. מחפש מישהו מנוסה ואמין.'
                    ],
                    'שיפוצים כלליים': [
                        'מחפש בעל מקצוע לשיפוץ דירת 3 חדרים. כולל צבע, גבס ותיקונים קלים.',
                        'דרוש מקצוען לתיקון חור בקיר גבס + צביעה. מישהו פנוי השבוע?',
                        'רוצה לשפץ את הסלון. מחפש מישהו שיכול לעשות הכל - צבע, רצפה, תקרה.'
                    ],
                    'פיתוח מגרשים': [
                        'מחפש חברה לפיתוח מגרש של 800 מ"ר לבניית בית פרטי. יש תוכניות מאושרות.',
                        'צריך פיתוח מגרש חקלאי כולל דרכי גישה וחיבור לתשתיות. מי יכול לעזור?',
                        'דרוש יזם לפיתוח קרקע של 2 דונם. מחפש מישהו עם ניסיון בפרויקטים דומים.'
                    ],
                    'בנייה': [
                        'מחפש קבלן לבניית בית פרטי 200 מ"ר. יש תוכניות מאושרות והיתרים.',
                        'צריך קבלן בנייה לתוספת חדר 20 מ"ר לבית קיים. מישהו יכול להמליץ?',
                        'דרוש קבלן מנוסה לפרויקט בנייה של וילה דו קומתית.'
                    ],
                    'ריצוף וחיפוי': [
                        'מחפש מרצף לדירה 80 מ"ר. רוצה גרניט פורצלן. מישהו יכול לתת הצעת מחיר?',
                        'צריך חיפוי קיר למטבח 15 מ"ר. יש לי כבר את החומרים. מישהו פנוי השבוע?',
                        'דרוש מרצף מנוסה לריצוף חצר בבית פרטי. שטח של 50 מ"ר.'
                    ],
                    'ציור': [
                        'מחפש צייר לצביעת דירה 3 חדרים. כולל תקרות וקירות. מישהו יכול להמליץ?',
                        'צריך צייר לצביעת חדר ילדים. רוצה צבעים עמידים ובטוחים. מי יכול לעזור?',
                        'דרוש צייר מקצועי לצביעת חזית בית פרטי. 2 קומות.'
                    ],
                    'גינון': [
                        'מחפש גנן לעיצוב גינה חדשה בבית פרטי. שטח 200 מ"ר. מישהו יכול להמליץ?',
                        'צריך גיזום עצים בגינה + הקמת מערכת השקיה. מישהו מנוסה בתחום?',
                        'דרוש גנן לתחזוקה חודשית של גינה. מחפש מישהו אמין וקבוע.'
                    ],
                    'מזגנים': [
                        'המזגן לא מקרר! צריך טכנאי בדחיפות. החום הורג אותנו כאן.',
                        'מחפש טכנאי מזגנים להתקנה חדשה בסלון. מה המחיר לאינוורטר?',
                        'המזגן עושה רעשים מוזרים ומטפטף מים. מישהו יכול לבוא לבדוק?'
                    ],
                    'נגרות': [
                        'מחפש נגר לבניית ארון חדר שינה לפי מידה. גובה 2.40 מטר.',
                        'צריך תיקון דלת כניסה שלא נסגרת טוב. מישהו יכול להגיע השבוע?',
                        'דרוש נגר לבניית ספסל פינת אוכל + אחסון. יש לי סקיצות.'
                    ],
                    'מסגרות': [
                        'מחפש מסגר להתקנת גדר לחצר. אורך 30 מטר. מישהו יכול לתת הערכת מחיר?',
                        'צריך תיקון שער חניה שנתקע. המנוע עובד אבל השער לא זז.',
                        'דרוש מסגר לבניית פרגולה בחצר. יש לי את התוכניות מוכנות.'
                    ]
                };

                // Create contextual posts based on field
                const getDefaultPosts = (field) => {
                    if (field.includes('עורך דין') || field.includes('משפטי')) {
                        return [
                            `מחפש עורך דין לייעוץ משפטי בנושא ${field.replace('עורך דין ', '')}. מישהו יכול להמליץ?`,
                            `צריך ייצוג משפטי בעניין דחוף. מחפש עורך דין מנוסה ב${field}.`,
                            `שלום, רוצה להתייעץ עם עורך דין לגבי חוזה. מישהו זמין לפגישה?`
                        ];
                    } else if (field.includes('רופא') || field.includes('רפואה')) {
                        return [
                            `מחפש ${field} טוב ומנוסה. מישהו יכול להמליץ על מומחה?`,
                            `צריך לקבוע תור ל${field} בדחיפות. מישהו מכיר מי זמין?`,
                            `שלום, מחפש המלצה על ${field} באזור. תודה מראש!`
                        ];
                    } else if (field.includes('מדריך') || field.includes('הדרכה')) {
                        return [
                            `מחפש ${field} למפגש חד פעמי. מישהו יכול להמליץ?`,
                            `צריך ${field} לקבוצה של 10 אנשים. מישהו זמין השבוע?`,
                            `שלום, רוצה להזמין ${field} לאירוע. מה המחירים?`
                        ];
                    } else {
                        return [
                            `מחפש ${field} מנוסה ואמין. מישהו יכול להמליץ?`,
                            `צריך ${field} לפרויקט חדש. מישהו זמין השבוע?`,
                            `שלום, מחפש ${field} איכותי. מה המחירים?`
                        ];
                    }
                };
                
                const defaultPosts = getDefaultPosts(primaryField);

                const templates = postTemplates[primaryField] || defaultPosts;
                
                // Add location context if work areas are specified
                const locations = workAreas && workAreas.length > 0 ? workAreas : ['אזור המרכז'];
                
                return templates.map(template => {
                    const location = locations[Math.floor(Math.random() * locations.length)];
                    return {
                        content: template,
                        location: location
                    };
                });
            }

            async callLocalPreviewAPI(formData, samplePosts) {
                try {
                    // Build the system prompt using the form data
                    const generator = new SimpleFormToPrompt();
                    const systemPrompt = generator.replaceAllPlaceholders(formData);

                    // Call the backend AI response endpoint
                    const response = await fetch(`${API_BASE_URL}/collabo-api/generate-ai-responses`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            system_prompt: systemPrompt,
                            posts: samplePosts
                        })
                    });

                    if (!response.ok) {
                        throw new Error(`Server Error: ${response.status}`);
                    }

                    const data = await response.json();

                    if (data.success && data.responses && data.responses.length > 0) {
                        // Format responses to match expected structure
                        return {
                            success: true,
                            responses: samplePosts.map((post, index) => ({
                                post: post,
                                response: this.appendWhatsAppLink(data.responses[index], formData.phone_number),
                                source: 'ai'
                            })),
                            apiKeyAvailable: true
                        };
                    } else {
                        throw new Error(data.error || 'AI response generation failed');
                    }
                } catch (error) {
                    console.error('AI API Error:', error);
                    // Fallback to mock responses
                    return {
                        success: true,
                        responses: samplePosts.map(post => ({
                            post: post,
                            response: this.generateMockResponse(post, formData.phone_number),
                            source: 'mock'
                        })),
                        apiKeyAvailable: false
                    };
                }
            }

            appendWhatsAppLink(response, phoneNumber) {
                // Append WhatsApp link in the format wa.me/+9725XXXXXXXX
                if (!phoneNumber) return response;
                return `${response}\nhttps://wa.me/+${phoneNumber}`;
            }

            generateMockResponse(userMessage, phoneNumber) {
                const clientName = document.querySelector('[name="client_name"]').value || 'המקצוען';
                const primaryField = document.querySelector('[name="primary_field"]').value || 'השירות';
                const phone = phoneNumber || '972521234567';

                return `שלום!

${clientName} כאן, ${primaryField} עם ניסיון רב בתחום.

אני זמין לעזור לך עם הבקשה שלך.

אשמח לתאם פגישה או שיחה קצרה כדי להבין בדיוק מה נדרש ולתת לך הערכת מחיר מדויקת.

ניתן ליצור קשר בווצאפ: wa.me/+${phone}

בהצלחה!
${clientName}`;
            }

            async generatePreview() {
                const previewContainer = document.getElementById('previewContainer');
                const loadingDiv = document.getElementById('previewLoading');
                const resultsDiv = document.getElementById('previewResults');
                
                // Show loading
                previewContainer.style.display = 'block';
                loadingDiv.style.display = 'block';
                resultsDiv.innerHTML = '';

                try {
                    // Get form data
                    const formData = this.collectFormData();
                    
                    // Validate form data before generating preview
                    const validationResult = this.validateFormData(formData);
                    if (!validationResult.isValid) {
                        throw new Error(validationResult.errorMessage);
                    }
                    
                    // Generate sample posts
                    const samplePosts = this.generateSamplePosts(formData.primary_field, formData.work_areas);
                    const postsContent = samplePosts.slice(0, 3).map(p => p.content);
                    
                    // Call local API to generate responses
                    const apiResponse = await this.callLocalPreviewAPI(formData, postsContent);
                    
                    if (apiResponse.success) {
                        this.updatePreviewResults(apiResponse.responses);
                        
                        // Show API status
                        if (!apiResponse.apiKeyAvailable) {
                            resultsDiv.innerHTML += '<div style="color: #f59e0b; text-align: center; margin-top: 10px; font-size: 14px;">⚠️ משתמש בתשובות דמה - מפתח API לא זמין</div>';
                        }
                    } else {
                        throw new Error('API response failed');
                    }
                    
                } catch (error) {
                    console.error('Preview generation error:', error);
                    
                    // Check if this is a validation error
                    if (error.message.includes('חסרים הפרטים הבאים:')) {
                        resultsDiv.innerHTML = `<div style="color: #dc2626; text-align: center; padding: 20px; background: #fef2f2; border: 1px solid #fecaca; border-radius: 8px; margin: 10px 0;">
                            <strong>לא ניתן ליצור תצוגה מקדימה</strong><br>
                            ${error.message}
                        </div>`;
                    } else {
                        resultsDiv.innerHTML = '<div style="color: #dc2626; text-align: center;">שגיאה ביצירת התצוגה המקדימה. וודא שהשרת פועל.</div>';
                    }
                } finally {
                    loadingDiv.style.display = 'none';
                }
            }

            collectFormData() {
                // Debug: Check global variables
                console.log('DEBUG: selectedWorkAreas:', typeof selectedWorkAreas !== 'undefined' ? selectedWorkAreas : 'undefined');
                console.log('DEBUG: selectedBusinessBenefits:', typeof selectedBusinessBenefits !== 'undefined' ? selectedBusinessBenefits : 'undefined');
                console.log('DEBUG: selectedSpecializations:', typeof selectedSpecializations !== 'undefined' ? selectedSpecializations : 'undefined');
                
                // Collect work areas from multiple sources
                let workAreas = [];
                
                // Try global variable first
                if (typeof selectedWorkAreas !== 'undefined' && selectedWorkAreas.length > 0) {
                    workAreas = selectedWorkAreas;
                    console.log('DEBUG: workAreas from global variable:', workAreas);
                } else {
                    // Try to read from the display element
                    const workAreaTags = document.getElementById('workAreaTags');
                    console.log('DEBUG: workAreaTags element:', workAreaTags);
                    console.log('DEBUG: workAreaTags children count:', workAreaTags ? workAreaTags.children.length : 'null');
                    if (workAreaTags && workAreaTags.children.length > 0) {
                        workAreas = Array.from(workAreaTags.children).map(span => {
                            console.log('DEBUG: processing work area span:', span.textContent);
                            return span.textContent.replace('×', '').trim();
                        }).filter(v => v);
                        console.log('DEBUG: workAreas from display element:', workAreas);
                    } else {
                        // Fallback: read from hidden inputs
                        const workAreaInputs = document.querySelectorAll('input[name="work_areas[]"]');
                        workAreas = Array.from(workAreaInputs).map(input => input.value).filter(v => v);
                        console.log('DEBUG: workAreas from hidden inputs:', workAreas);
                    }
                }

                // Collect business benefits from the global array (if available) or hidden inputs
                let businessBenefits = [];
                if (typeof selectedBusinessBenefits !== 'undefined' && selectedBusinessBenefits.length > 0) {
                    businessBenefits = selectedBusinessBenefits.map(b => b.text || b);
                } else {
                    // Fallback: read from hidden inputs
                    const benefitInputs = document.querySelectorAll('input[name="business_benefits[]"]');
                    businessBenefits = Array.from(benefitInputs).map(input => input.value).filter(v => v);
                    console.log('DEBUG: businessBenefits from hidden inputs:', businessBenefits);
                }

                // Collect specializations from multiple sources
                let specializations = [];
                
                // Try global variable first
                if (typeof selectedSpecializations !== 'undefined' && selectedSpecializations.length > 0) {
                    specializations = selectedSpecializations.map(s => s.text || s);
                    console.log('DEBUG: specializations from global variable:', specializations);
                } else {
                    // Try to read from the display element
                    const specializationsDisplay = document.getElementById('specializationsDisplay');
                    console.log('DEBUG: specializationsDisplay element:', specializationsDisplay);
                    console.log('DEBUG: specializationsDisplay children count:', specializationsDisplay ? specializationsDisplay.children.length : 'null');
                    if (specializationsDisplay && specializationsDisplay.children.length > 0) {
                        specializations = Array.from(specializationsDisplay.children).map(span => {
                            console.log('DEBUG: processing span:', span.textContent);
                            return span.textContent.replace('×', '').trim();
                        }).filter(v => v && v !== 'לחצו לבחירת התמחויות נוספות');
                        console.log('DEBUG: specializations from display element:', specializations);
                    } else {
                        // Fallback: read from hidden inputs
                        const specInputs = document.querySelectorAll('input[name="specializations[]"]');
                        specializations = Array.from(specInputs).map(input => input.value).filter(v => v);
                        console.log('DEBUG: specializations from hidden inputs:', specializations);
                    }
                }

                // Collect restrictions from the global array (if available) or hidden inputs
                let restrictions = [];
                if (typeof selectedRestrictions !== 'undefined' && selectedRestrictions.length > 0) {
                    restrictions = selectedRestrictions;
                } else {
                    // Fallback: read from hidden inputs
                    const restrictionInputs = document.querySelectorAll('input[name="restrictions[]"]');
                    restrictions = Array.from(restrictionInputs).map(input => input.value).filter(v => v);
                }

                // Format phone number to 9725XXXXXXXX
                const rawPhone = document.querySelector('[name="phone_number"]').value || '';
                const phoneNumber = formatPhoneNumber(rawPhone);

                const formData = {
                    client_name: document.querySelector('[name="client_name"]').value || 'המקצוען',
                    primary_field: document.querySelector('[name="primary_field"]').value || 'שיפוצים כלליים',
                    experience_years: document.querySelector('[name="experience_years"]').value || '10',
                    phone_number: phoneNumber,
                    work_areas: workAreas,
                    business_benefits: businessBenefits,
                    additional_specializations: specializations,
                    restrictions: restrictions
                };

                console.log('DEBUG: Final form data:', formData);
                return formData;
            }

            buildSystemPrompt(formData) {
                // Use the existing prompt template building logic
                const generator = new SimpleFormToPrompt();
                return generator.replaceAllPlaceholders(formData);
            }

            updatePreviewResults(results) {
                const resultsDiv = document.getElementById('previewResults');
                
                resultsDiv.innerHTML = results.map((result, index) => {
                    // Extract name and content from post
                    console.log('Raw post:', result.post); // Debug log
                    const postLines = result.post.split('\n').filter(line => line.trim() !== '');
                    console.log('Post lines (filtered):', postLines); // Debug log
                    
                    let authorName, postContent;
                    
                    if (postLines.length >= 2) {
                        // Format: Name\n\nContent or Name\nContent
                        let rawAuthorName = postLines[0];
                        
                        // Remove number prefix if exists (e.g., "1. דני כהן" -> "דני כהן")
                        authorName = rawAuthorName.replace(/^\d+\.\s*/, '');
                        
                        postContent = postLines.slice(1).join(' ');
                    } else if (postLines.length === 1) {
                        // Only content, generate a name
                        let singleLine = postLines[0];
                        
                        // Check if it starts with a number and name
                        const nameMatch = singleLine.match(/^(\d+\.\s*)?([א-ת]+\s+[א-ת]+)/);
                        if (nameMatch) {
                            authorName = nameMatch[2];
                            const remainingText = singleLine.replace(/^(\d+\.\s*)?[א-ת]+\s+[א-ת]+\s*/, '');
                            postContent = remainingText || 'מחפש בעל מקצוע אמין בתחום.';
                        } else {
                            // If line doesn't contain a name, treat entire line as content
                            authorName = 'משתמש אנונימי';
                            postContent = singleLine;
                        }
                    } else {
                        // Fallback
                        authorName = 'משתמש';
                        postContent = result.post || 'מחפש בעל מקצוע לעבודה.';
                    }
                    
                    // Ensure we have content
                    if (!postContent || postContent.trim() === '') {
                        postContent = 'מחפש בעל מקצוע אמין לעבודה.';
                    }
                    
                    console.log('Author:', authorName, 'Content:', postContent); // Debug log
                    
                    // Get first letter for avatar
                    const avatarLetter = authorName.charAt(0);
                    
                    return `
                        <div class="facebook-post-card">
                            <div class="post-header">
                                <div class="post-avatar">${avatarLetter}</div>
                                <div class="post-meta">
                                    <div class="post-author">${authorName}</div>
                                    <div class="post-time">${Math.floor(Math.random() * 12) + 1} דק'</div>
                                </div>
                            </div>
                            <div class="post-content">${postContent}</div>
                            
                            <div class="post-interactions">
                                <div class="interactions-bar">
                                    <span class="interaction-btn">👍 אהבתי</span>
                                    <span class="interaction-btn">💬 תגובה</span>
                                    <span class="interaction-btn">📤 שתף</span>
                                </div>
                            </div>
                            
                            <div class="comments-section">
                                <div class="comment">
                                    <div class="comment-avatar">ס</div>
                                    <div class="comment-content">
                                        <div class="comment-author">הסוכן שלך</div>
                                        <div class="comment-text">${formatLinksInText(result.response)}</div>
                                        <div class="comment-actions">
                                            <span class="comment-action">אהבתי</span>
                                            <span class="comment-action">השב</span>
                                            <span class="comment-time">עכשיו</span>
                                            <span class="comment-source">${result.source === 'claude' ? 'Claude AI' : 'הדמיה'}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
            }

            validateFormData(formData) {
                const missingFields = [];
                
                // Question 1: Name (required)
                if (!formData.client_name || formData.client_name.trim() === '') {
                    missingFields.push('1. שם העסק שלכם');
                }
                
                // Question 2: Primary field (required)
                if (!formData.primary_field || formData.primary_field.trim() === '') {
                    missingFields.push('2. תחום פעילות עיקרי');
                }
                
                // Question 3: Experience years (required)
                if (!formData.experience_years || formData.experience_years.trim() === '') {
                    missingFields.push('3. כמה שנים העסק שלכם פעיל');
                }
                
                // Question 4: Phone number (required)
                if (!formData.phone_number || formData.phone_number.trim() === '') {
                    missingFields.push('4. מספר טלפון');
                }
                
                // Question 5: Work areas (required)
                if (!formData.work_areas || formData.work_areas.length === 0) {
                    missingFields.push('5. אזורי פעילות');
                }
                
                // Question 6: Business benefits (required - at least 4)
                if (!formData.business_benefits || formData.business_benefits.length < 4) {
                    missingFields.push('6. יתרונות עסקיים (נדרשים לפחות 4)');
                }
                
                // Question 7: Specializations (OPTIONAL - not required)

                // Question 8: Restrictions/limitations (OPTIONAL - not required)
                
                if (missingFields.length > 0) {
                    const errorMessage = `חסרים הפרטים הבאים:\n${missingFields.join('\n')}`;
                    return {
                        isValid: false,
                        errorMessage: errorMessage
                    };
                }
                
                return {
                    isValid: true,
                    errorMessage: null
                };
            }
        }

        // Initialize Live Preview System when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => {
                new LivePreviewSystem();
            });
        } else {
            new LivePreviewSystem();
        }

        /**
         * SimpleFormToPrompt Class - מוטמע מהקובץ המקורי
         * Simple Form to Prompt JSON - יצירת JSON עם הטמפלט המלא והחלפת פליסהולדרים
         */
        class SimpleFormToPrompt {
            constructor() {
                // הטמפלט המלא מהקובץ המקורי - נועתק בשלמותו
                this.promptTemplate = 

`═══════════════════════════════════════════════════════════════════════════════════
פרטי בעל המקצוע
═══════════════════════════════════════════════════════════════════════════════════

📌 זהותך
אתה בעל מקצוע שעונה לפוסטים של אנשים המחפשים שירותים/בעלי מקצוע.

פרטים עיקריים של בעל המקצוע:
* שם: {{CLIENT_NAME}}
* תחום פעילות עיקרי: {{PRIMARY_FIELD}}
* ניסיון: {{EXPERIENCE_YEARS}} שנים
* אזור עבודה: {{WORK_AREAS}}

יתרונות עסקיים - {{CLIENT_NAME}} מציע:
{{BUSINESS_ADVANTAGES}}

התמחויות נוספות של {{CLIENT_NAME}}:
{{SPECIALIZATIONS}}

האופי של בעל המקצוע:
{{CLIENT_NAME}} הוא בעל מקצוע בשנות ה-30 לחייו. בעל אנרגיות ורצון לעזור לכולם! {{CLIENT_NAME}} אדיב, חברתי, אנושי, מקצועי, נעים וזורם. {{CLIENT_NAME}} כותב תגובות ענייניות בלבד, אבל עם אופי נעים וברור! {{CLIENT_NAME}} מסביר בצורה מקצועית מה נדרש לבצע, ואיך הוא ניגש לביצוע פרויקט.
{{CLIENT_NAME}} לעולם לא מתחנף ללקוחות, לא יהיר, ולא מנסה לרצות או לאשר את הצורך והבעיה של האנשים להם הוא מגיב – אלא מספק תגובה מדויקת, עם ערך שמיש ואינפורמטיבי בלבד!



═══════════════════════════════════════════════════════════════════════════════════
פרמטרים לניתוח פוסט
═══════════════════════════════════════════════════════════════════════════════════

🔎 ניתוח פרמטרים מתוך כוונת כותב הפוסט
1. דחיפות - זיהוי רמת הדחיפות של הלקוח
2. אמינות - זיהוי ואיתור האלמנטים הנדרשים לצורך ניסוח מדויק של מרכיב האמינות, בתגובה שבעל המקצוע יוצר עבור כותב הפוסט.
3. מיקוד - זיהוי כוונת כותב הפוסט, לצורך ניסוח תגובה ממוקדת ומדויקת.
4. ערך - זיהוי ואיתור של האלמנטים הנדרשים לצורך ניסוח מדויק של מרכיב ערך התגובה, בתגובה שבעל המקצוע יוצר עבור כותב הפוסט.
5. משקל - זיהוי וניתוח משקל של כל אחד ממרכיבי התגובה, עבור ניסוח נכון של תגובה.
6. מבנה - ניתוח מבנה התגובה ואופן הסדר בו מנסחים וכותבים כל אחד ממרכיבי התגובה.
7. 🔍 ניתוח יתרונות רלוונטיים:
- נתח את הפוסט וכוונת כותב הפוסט וזהה את הצורך/בעיה המרכזית, ותבחר את היתרונות העסקיים של בעל המקצוע הרלוונטים ביותר.

═══════════════════════════════════════════════════════════════════════════════════
פרטי התגובה
═══════════════════════════════════════════════════════════════════════════════════

🎯 מטרת התגובה
"למכור" את השירותים של בעל המקצוע המגיב לפוסט, ע"י כך שבעל המקצוע מספק ערך אמיתי, אינפורמטיבי ופרקטי בתגובה שלו, בהתאם לכוונת וצורך כותב הפוסט.

📝 עקרונות יסוד בעת ניסוח תגובה
1. עקרון מרכזי: כל תגובה חייבת לכלול ערך אמיתי ומועיל לכותב הפוסט - ללא בקשה לדרישה למידע נוסף מכותב הפוסט.
2 ניסוח התגובה חייב להיות "זורם". כל מילה ומשפט חייבים להתקשר למילה או המשפט הקודם, ולמילה או המשפט המגיעה אחריו.
3. הערך שכותבים חייב להעשיר את ידע והבנת כותב הפוסט, בהקשר ישיר לסוג הפוסט העיקרי, ולכוונת כותב הפוסט.
4. לפני כתיבת התגובה, נתח את כוונת כותב הפוסט ובחר 1-2 יתרונות עסקיים הכי רלוונטיים למצבו הספציפי
5. תמיד לחתום בסוף תגובה בשם של בעל המקצוע.
6. עיקרון חשוב מאוד - כל תגובה של בעל מקצוע צריכה להיות מינימום 70 מילים, עד מקסימום של 75 מילים!
        
📂 סוגי פוסטים
* סוג 1: מחפשים מידע נוסף/עצה מקצועית
* סוג 2: מחפשים בעל מקצוע ללא תיאור.
* סוג 3: מחפשים בעל מקצוע עם תיאור של העבודה/השירות.
* סוג 4: מחפשים הצעת מחיר.
* סוג 5: מחפשים המלצה.
חשוב: יש פוסטים היכולים להכיל מגוון סוגים שונים בתוכם, ולכן צריך להבין איפה יש לשים יותר משקל בניסוח הפוסט בהתאם לכוונת כותב הפוסט.

🎤 טון התגובה
* חברי, אדיב, מקצועי, אינפורמטיבי, והכי חשוב - קליל!
* לא מחנך ולא מתחנף.
* לא מנסה להתחבב או לרצות את הלקוח.
* כל משפט חייב להתחבר באופן טבעי למשפט הקודם והבא אחריו → זרימה טבעית והגיונית.
* ישיר ומקצועי.

🧩 מרכיבי תגובה:
כל תגובה מכילה את כל אחד ממרכיבי התגובה.

1. פתיח של תגובה:
משפט קצר הפותח את התגובה (בין 2-4 מילים במקסימום).
אופן פתיחת התגובה צריך להיות בהתאם לסגנון שבו כותב הפוסט מתנסח בפוסט.
דוגמאות לאופן פתיחת תגובה:
* [תראה/לרוב/במקרים כאלו, וכדומה] + [שם כותב הפוסט]
* [שלום/אהלן/בוקר טוב/מה שלומך?/היי] + [שם כותב הפוסט]

2. ערך העיקרי של תגובה:
הערך שבעל המקצוע מספק לכותב הפוסט בעת כתיבת תגובה צריך לשרת את המטרה העיקרית, והיא - "למכור" את שירותיו של בעל המקצוע לכותב הפוסט, דרך התגובה.
הערך של התגובה שבעל המקצוע כותב יכול להיות מורכב מאחד (או יותר) האלמנטים הבאים. ניתן לשלב מספר אלמנטים יחד, אבל הם חייבים להיות בהקשר הגיוני וטבעי.
האלמנטים:
* תיאור מקצועי ואדיב המתאר איך בעל המקצוע יבצע את העבודה/השירות - רלוונטי לכל סוגי הפוסטים.
* הסבר מקצועי - רלוונטי רק לפוסטים מסוג 1.
* תיאור מרכיבי הצעת מחיר - רלוונטי לפוסטים מסוג 3.
* הסבר על כך שבעל המקצוע יודע לבצע את כל סוגי העבודות בתחום פעילות שלו - רלוונטי לפוסטים מסוג 2.

3. בניית אמון:
מטרת רכיב זה היא לגרום לכותב הפוסט להאמין שבעל מקצוע שכותב לו, הוא אמין, מקצועי, ושכדאי לכותב הפוסט לרכוש את שירותיו!
אלמנטים ליצירת אמון:
* הדגשת שקיפות בתהליך העבודה של בעל המקצוע מול כותב הפוסט.
* הדגשת היתרונות של בעל המקצוע.

4. סיום תגובה:
משפט המכיל את (אחד או יותר) מרכיבי סיום השיחה הבאים, אבל חייב להכיל את המרכיב הרביעי:
* הזמנה של כותב הפוסט לשאול את בעל המקצוע שאלות נוספות [תרגיש חופשי לפנות אם יש שאלות נוספות/זמין לשאלות נוספות, וכדומה].
* תיאור שבעל המקצוע שמח לעזור [שמח לעזור/אשמח לעזור].
* איחולי הצלחה [שיהיה בהצלחה/בהצלחה רבה/תצליחי/תצליח].
* תמיד לנסח משפט קצר המסביר לכותב הפוסט שאפשר ומומלץ לפנות אל בעל המקצוע דרך הווצאפ, כדי להעביר תמונות/הסבר נוסף, וכל פרט מידע שיעזור לבעל המקצוע להבין את העבודה, או לספק הצעת מחיר עבור כותב הפוסט.

═══════════════════════════════════════════════════════════════════════════════════
איסורים בעת ניסוח תגובה!
═══════════════════════════════════════════════════════════════════════════════════

איסורים שבעל המקצוע חייב להקפיד עליהם בעת ניסוח הודעה:

1. איסורים הקשורים לאופי השפה והסגנון של בעל המקצוע:

❌ אסור לכתוב תגובה שהיא פחות מ-70 מילים, ויותר מ-70 מילים במקסימום!.
❌ אסור להשתמש בשפה גבוהה, טכניות ועסקית מידי בעת ניסוח תגובות.
❌ אסור להשתמש במשפטים או מילים שמייצרים רושם שבעל המקצוע בא לחנך, ללמד, להסביר, להרצות, לשבח, להדיר, להתחנף  או לאשר את דברי כותב הפוסט, בקשתו, או תיאור הבעיה שהוא ציין בפוסט, וכנ"ל גם אסור להשתמש במשפטים או מילים כאלו מצד בעל המקצוע כאשר הוא מנסח תגובה לכותב הפוסט, לכל אורך ושלבי ניסוח התגובה!

2. איסורים הקשורים לסוגי פוסטים:

❌ בפוסטים מסוג 2 (מחפשים בעל מקצוע), סוג 3 (מחפשים הצעת מחיר), וסוג 4 (מחפשים הצעת מחיר), אסור לתאר יתרונות שלא צוינו בפוסט.
❌ אסור לתת הערכות מחיר, עלויות או כל פרט הקשור למחיר.
❌ אסור לאשר או לשקף את כוונת כותב הפוסט (למשל: "נכון, זה בדיוק מה שאתה צריך").
❌ אסור לבצע השוואות או לדבר על שירותים אחרים (למשל: "זה לא כמו…", "שונה מ…", "להבדיל מ…", "בניגוד ל…").
❌ אסור להשתמש בביטויים שמרמזים על מורכבות או דרישות מיוחדות מהתחום (למשל: "דורש התמחות מיוחדת").

3. איסורים על מידע ופרטים חיצוניים:

❌ אסור לציין מידע שלא סופק בפרמטרים של בעל המקצוע.
❌ אסור לבצע חישובים מכל סוג ואופן.
❌ אסור לציין מיקומים שכותב הפוסט ציין בפוסט.
❌ אסור להתייחס לקבצים או תמונות שצורפו לפוסט.

4. איסורים על הבטחות והתחייבויות:

❌ אסור ליצור הבטחות מוגזמות שהלקוח לא ביקש במפורש.
❌ אסור לציין או להבטיח בשום פנים ואופן זמני ביצוע או תוצאות של העבודה או השירות הנדרש.

5. נושאים ש{{CLIENT_NAME}} מעדיף להימנע מהם בהודעות שלו:

{{RESTRICTIONS}}

6. 🚫 איסור חמור במיוחד לגבי התמחויות נוספות:
❌ אסור לציין או להתייחס להתמחויות הנוספות של {{CLIENT_NAME}} אלא אם כן זוהה בפוסט תת-תחום ספציפי שקשור ישירות לאחת מההתמחויות הנוספות.
❌ אם הפוסט מדבר על התחום העיקרי בלבד, אין לציין שום התמחות נוספת.
❌ רק אם נזכר בפוסט תת-תחום ספציפי שמופיע ברשימת ההתמחויות הנוספות, רק אז מותר להתייחס אליו.
❌ לעולם לא לציין התמחות נוספת שלא רלוונטית לכוונת כותב הפוסט או לסוג השירות שהוא מחפש.`;

            }

            /**
             * יצירת JSON עם הטמפלט המוחלף
             */
            generateJSON(formData) {
                // החלפת הפליסהולדרים
                const finalPrompt = this.replaceAllPlaceholders(formData);
                
                return {
                    metadata: {
                        client_name: formData.client_name || formData.name || 'לא צוין',
                        primary_field: formData.primary_field || 'לא צוין',
                        creation_date: new Date().toISOString(),
                        version: "3.0"
                    },
                    system_prompt: finalPrompt,
                    original_form_data: formData
                };
            }

            /**
             * החלפת כל הפליסהולדרים
             */
            replaceAllPlaceholders(formData) {
                let result = this.promptTemplate;
                
                // החלפות בסיסיות - תמיכה בשדות שונים מהטופס
                const clientName = formData.client_name || formData.name || 'בעל מקצוע';

                result = result.replace(/{{CLIENT_NAME}}/g, clientName);
                result = result.replace(/{{PRIMARY_FIELD}}/g, formData.primary_field || 'שיפוצים כלליים');
                result = result.replace(/{{EXPERIENCE_YEARS}}/g, formData.experience_years || '15');
                result = result.replace(/{{WORK_AREAS}}/g, this.formatWorkAreas(formData.work_areas));
                
                // החלפות מורכבות
                result = result.replace(/{{BUSINESS_ADVANTAGES}}/g, this.buildBusinessAdvantages(formData));
                result = result.replace(/{{SPECIALIZATIONS}}/g, this.buildSpecializations(formData));
                result = result.replace(/{{RESTRICTIONS}}/g, this.buildRestrictions(formData));
                
                return result;
            }

            // NOTE: not used anywhere
            formatPhone(phone) {
                if (!phone) return '972521234567';
                const clean = phone.replace(/\D/g, '');
                if (clean.startsWith('0')) return '972' + clean.slice(1);
                if (clean.startsWith('972')) return clean;
                return '972' + clean;
            }

            formatWorkAreas(areas) {
                if (!areas || !Array.isArray(areas) || areas.length === 0) return 'כל הארץ';
                return areas.join(', ');
            }

            buildBusinessAdvantages(formData) {
                const advantages = [];
                
                // ניסיון (תמיד כולל)
                if (formData.experience_years) {
                    advantages.push(`✅ ניסיון של ${formData.experience_years} שנים`);
                }
                
                // יתרונות עסקיים שנבחרו
                if (formData['business_benefits[]']) {
                    const businessBenefits = Array.isArray(formData['business_benefits[]']) 
                        ? formData['business_benefits[]'] 
                        : [formData['business_benefits[]']];
                    
                    businessBenefits.forEach(benefit => {
                        advantages.push(`🔧 ${benefit}`);
                    });
                }
                
                return advantages.join('\n') || 'שירות מקצועי ואמין';
            }


            buildRestrictions(formData) {
                const restrictions = [];
                
                // הגבלות מהשאלה 7
                if (formData.restrictions && Array.isArray(formData.restrictions)) {
                    formData.restrictions.forEach(restriction => {
                        restrictions.push(`❌ ${restriction}`);
                    });
                }
                
                // הגבלות נוספות מהטופס
                if (formData.minimum_job_value) {
                    restrictions.push(`💰 עבודות מתחת ל${formData.minimum_job_value}`);
                }
                if (formData.availability === 'weekdays_only') {
                    restrictions.push('⏰ עבודה בסופי שבוע');
                }
                
                return restrictions.join('\n') || 'ללא הגבלות מיוחדות';
            }

            /**
             * בניית מקטע התמחויות נוספות
             */
            buildSpecializations(formData) {
                const specializations = [];
                
                if (formData.specializations && Array.isArray(formData.specializations) && formData.specializations.length > 0) {
                    // קיבוץ לפי קטגוריה
                    const groupedSpecializations = {};
                    formData.specializations.forEach(spec => {
                        const category = spec.category || 'התמחויות נוספות';
                        if (!groupedSpecializations[category]) {
                            groupedSpecializations[category] = [];
                        }
                        groupedSpecializations[category].push(spec);
                    });
                    
                    // בניית הטקסט לפי קטגוריות
                    Object.keys(groupedSpecializations).forEach(category => {
                        specializations.push(`\n🔧 ${category}:`);
                        groupedSpecializations[category].forEach(spec => {
                            const icon = spec.isCustom ? '⭐' : '•';
                            specializations.push(`${icon} ${spec.text}`);
                        });
                    });
                    
                    return `${formData.client_name || 'בעל המקצוע'} מתמחה גם בתחומים הבאים:${specializations.join('\n')}`;
                }
                
                return `${formData.client_name || 'בעל המקצוע'} מתמחה אך ורק בתחום העיקרי שלו: ${formData.primary_field || 'תחום הפעילות'}.`;
            }

            /**
             * יצירת קובץ JSON
             */
            async generateJSONFile(formData) {
                const data = this.generateJSON(formData);
                const fileName = `system_prompt_${(formData.name || 'client').replace(/\s+/g, '_')}_${new Date().toISOString().split('T')[0]}.json`;

                // שליחת JSON לשרת
                const jsonString = this.formatJSONNicely(data);

                const response = await fetch(`${API_BASE_URL}/collabo-api/pro-form`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: jsonString
                });

                if (!response.ok) {
                    throw new Error(`Server error: ${response.status}`);
                }

                const result = await response.json();

                return {
                    fileName: fileName,
                    data: data,
                    size: jsonString.length,
                    serverResponse: result
                };
            }

            /**
             * פורמט JSON יפה עם שורות חדשות אמיתיות
             */
            formatJSONNicely(data) {
                // מטאדאטה מצומצמת - רק החלקים הרלוונטיים
                const cleanMetadata = {
                    client_name: data.metadata.client_name,
                    primary_field: data.metadata.primary_field,
                    creation_date: data.metadata.creation_date
                };

                const jsonObj = {
                    metadata: cleanMetadata,
                    system_prompt: data.system_prompt,
                    original_form_data: data.original_form_data
                };

                return JSON.stringify(jsonObj, null, 2);
            }
        }

        window.SimpleFormToPrompt = SimpleFormToPrompt;

        /**
         * Format Israeli phone number to 9725XXXXXXXX format
         * @param {string} phone - Phone number in any Israeli format
         * @returns {string} Formatted phone number as 9725XXXXXXXX
         */
        function formatPhoneNumber(phone) {
            if (!phone) return '';
            const clean = phone.replace(/\D/g, '');
            if (clean.startsWith('0')) {
                return '972' + clean.slice(1);
            } else if (clean.startsWith('972')) {
                return clean;
            } else {
                return '972' + clean;
            }
        }

        // Make it globally available
        window.formatPhoneNumber = formatPhoneNumber;
    </script>
</body>

</html>
